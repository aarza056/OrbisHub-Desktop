<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<!-- Electron CSP: restrict sources while allowing current inline handlers and Google Fonts -->
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: blob:; connect-src 'self'; frame-src 'none'; object-src 'none'; base-uri 'self'; form-action 'self'">
<title>OrbisHub</title>
<link rel="icon" type="image/x-icon" href="../media/favicon.ico">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="styles.css" />
<link rel="stylesheet" href="../Functions/OrbisAgent/agent-ui.css" />
<link rel="stylesheet" href="../Functions/TicketManagement/ticket-ui.css" />
<link rel="stylesheet" href="../Functions/PasswordManager/password-ui.css" />
<link rel="stylesheet" href="../Functions/BugReporting/bug-ui.css" />
<link rel="stylesheet" href="../Functions/EmailServerProfile/email-ui.css" />
<link rel="stylesheet" href="../Functions/UserRecovery/recovery-ui.css" />
<link rel="stylesheet" href="../Functions/DBMaintenance/db-maintenance-ui.css" />
<link rel="stylesheet" href="../Functions/UserPermissions/permissions-ui.css" />
</head>
<body>

<!-- Login Screen -->
<div id="loginScreen" class="login-screen">
<div class="login-container">
<div class="login-header">
  <img src="../media/logo.png" alt="OrbisHub logo" class="brand__logo">
  <div class="login-brand">OrbisHub</div>
  <p class="login-tagline">By Admins, For Admins</p>
  
  <!-- Database Status Indicator -->
  <div id="loginDbStatus" class="login-db-status">
    <div class="login-db-status-icon">
      <div class="spinner-ring" style="width:12px; height:12px; border-width:2px;"></div>
    </div>
    <span class="login-db-status-text">Checking database...</span>
  </div>
</div>
<form id="loginForm" class="login-form">
  <div class="login-error" id="loginError"></div>
  <label class="label">
    <span>Username</span>
    <input id="loginUsername" type="text" class="input" placeholder="Enter your username" required autofocus autocomplete="username" />
  </label>
  <label class="label">
    <span>Password</span>
    <input id="loginPassword" type="password" class="input" placeholder="Enter your password" required autocomplete="current-password" />
  </label>
  <button type="submit" class="btn btn-primary" style="width:100%; margin-top:8px;">Sign In</button>
  
  <!-- Forgot Password Link -->
  <div style="text-align: center; margin-top: 15px;">
    <a href="#" class="forgot-password-link" onclick="RecoveryUI.openForgotPasswordModal(); return false;"
       style="color: #667eea; text-decoration: none; font-size: 14px; font-weight: 500; transition: color 0.2s;">
      Forgot Password?
    </a>
  </div>
</form>
<div class="login-footer">
  <p class="muted" style="font-size:12px; text-align:center; margin-bottom:8px;">Centralized platform for SysAdmins & DevOps</p>
  <button id="clearConfigBtn" class="btn-link" style="font-size:11px; color:var(--muted); text-decoration:none; background:none; border:none; cursor:pointer; padding:4px 8px; display:block; margin:0 auto;" title="Clear all configuration and start fresh">
    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:middle; margin-right:4px;">
      <polyline points="1 4 1 10 7 10"></polyline>
      <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
    </svg>
    Clear Configuration
  </button>
</div>
</div>

<!-- Loading Screen -->
<div class="loading-screen" id="loadingScreen">
  <div class="loading-content">
    <div class="loading-spinner">
      <div class="spinner-ring"></div>
      <div class="spinner-ring"></div>
      <div class="spinner-ring"></div>
    </div>
    <div class="loading-text">Initializing Orbis</div>
    <div class="loading-subtext">Securing your session...</div>
  </div>
</div>
</div>

<!-- Database Setup Wizard -->
<div id="setupWizard" class="setup-wizard" style="display:none;">
  <div class="setup-container">
    <div class="setup-header">
      <img src="../media/logo.png" alt="OrbisHub logo" class="brand__logo">
      <h1>Welcome to OrbisHub Desktop</h1>
      <p class="setup-tagline">Let's configure your database connection</p>
    </div>
    
    <!-- Step 1: Database Configuration -->
    <div id="setupStep1" class="setup-step" style="display:block;">
      <div class="setup-step-header">
        <div class="setup-step-number">1</div>
        <h2>Database Configuration</h2>
      </div>
      
      <div class="setup-form">
        <label class="label">SQL Server Address
          <input id="setupServerName" class="input" placeholder="localhost\SQLEXPRESS or server.domain.com" value="localhost\SQLEXPRESS" />
          <span class="input-hint">Enter your SQL Server instance name or IP address</span>
          <span class="input-hint" style="color:#fcd34d;">üí° Docker SQL Server? Use <strong>localhost,1433</strong> and SQL Authentication below</span>
        </label>
        
        <label class="label">Database Name
          <input id="setupDatabaseName" class="input" placeholder="OrbisHub" value="OrbisHub" />
          <span class="input-hint">Name for your OrbisHub database</span>
        </label>
        
        <label class="label">Authentication Type
          <select id="setupAuthType" class="input">
            <option value="windows">Windows Authentication (Recommended)</option>
            <option value="sql">SQL Server Authentication</option>
          </select>
        </label>
        
        <div id="setupSqlAuthFields" style="display:none;">
          <label class="label">Username
            <input id="setupUsername" class="input" placeholder="sa" />
          </label>
          <label class="label">Password
            <input id="setupPassword" type="password" class="input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
          </label>
        </div>
        
        <label class="label" style="display:flex; align-items:center; gap:8px; cursor:pointer;">
          <input type="checkbox" id="setupTrustCert" checked />
          <span>Trust Server Certificate (Required for local & Docker SQL Server)</span>
        </label>
        
        <label class="label" style="display:flex; align-items:center; gap:8px; cursor:pointer;">
          <input type="checkbox" id="setupEncrypt" />
          <span>Encrypt Connection</span>
        </label>
      </div>
      
      <div class="setup-actions">
        <button id="setupCancelBtn" class="btn btn-ghost">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:8px;">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
          Back to Login
        </button>
        <button id="setupTestConnectionBtn" class="btn btn-secondary" style="flex:1;">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:8px;">
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
          Test Connection
        </button>
        <button id="setupNextBtn" class="btn btn-primary" style="flex:1;" disabled>
          Next
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-left:8px;">
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </button>
      </div>
      
      <div id="setupConnectionStatus" class="setup-status" style="display:none;"></div>
    </div>
    
    <!-- Step 2: Database Creation -->
    <div id="setupStep2" class="setup-step" style="display:none;">
      <div class="setup-step-header">
        <div class="setup-step-number">2</div>
        <h2>Database Setup</h2>
      </div>
      
      <div id="setupDbExistsMessage" class="setup-message" style="display:none;">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2" style="margin-right:12px;">
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
        <span>Database already exists and is ready to use!</span>
      </div>
      
      <div id="setupDbNotExistsMessage" class="setup-message setup-message-warning" style="display:none;">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2" style="margin-right:12px;">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="12"></line>
          <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
        <span>Database does not exist. It will be created for you.</span>
      </div>
      
      <div class="setup-actions">
        <button id="setupBackBtn" class="btn btn-ghost">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:8px;">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
          Back
        </button>
        <button id="setupCreateDbBtn" class="btn btn-primary" style="flex:1;">
          Create Database & Setup Schema
        </button>
      </div>
      
      <div id="setupDbStatus" class="setup-status" style="display:none;"></div>
    </div>
    
    <!-- Step 3: Running Migrations -->
    <div id="setupStep3" class="setup-step" style="display:none;">
      <div class="setup-step-header">
        <div class="setup-step-number">3</div>
        <h2>Building Database Schema</h2>
      </div>
      
      <div class="setup-progress">
        <div class="setup-progress-bar">
          <div id="setupMigrationProgress" class="setup-progress-fill"></div>
        </div>
        <div id="setupMigrationStatus" class="setup-progress-text">Initializing...</div>
      </div>
      
      <div id="setupMigrationsList" class="setup-migrations-list"></div>
    </div>
    
    <!-- Step 4: Complete -->
    <div id="setupStep4" class="setup-step" style="display:none;">
      <div class="setup-step-header">
        <div class="setup-step-number">‚úì</div>
        <h2>Setup Complete!</h2>
      </div>
      
      <div class="setup-complete-message">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2">
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
        <h3>Your database is ready!</h3>
        <p>Default admin account has been created:</p>
        <div class="setup-credentials">
          <div><strong>Username:</strong> admin</div>
          <div><strong>Password:</strong> admin</div>
        </div>
        <p class="setup-warning">‚ö†Ô∏è Please change the admin password after your first login!</p>
      </div>
      
      <div class="setup-actions">
        <button id="setupFinishBtn" class="btn btn-primary" style="width:100%;">
          Continue to Login
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Connection Wizard Modal -->
<dialog id="connectionWizard" class="modal">
  <form method="dialog" class="card" style="max-width: 800px; width: 90vw;">
    <button type="submit" value="cancel" class="modal-close-btn" title="Close">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
    
    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
      <div style="width: 48px; height: 48px; border-radius: 12px; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
          <polyline points="23 4 23 10 17 10"></polyline>
          <polyline points="1 20 1 14 7 14"></polyline>
          <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
        </svg>
      </div>
      <div>
        <h2 style="margin: 0;">Reconnect to Database</h2>
        <p class="muted" style="margin: 4px 0 0 0; font-size: 13px;">Review your connection settings and try connecting again</p>
      </div>
    </div>
    
    <div style="background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; padding: 20px; margin: 20px 0;">
      <div style="display: grid; gap: 16px;">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
          <div>
            <label class="label" style="margin-bottom: 6px; font-size: 12px; font-weight: 600; color: var(--muted); text-transform: uppercase; letter-spacing: 0.5px;">SQL Server Address</label>
            <input type="text" id="reconnectServerName" class="input" placeholder="localhost\SQLEXPRESS" style="font-family: 'Courier New', monospace;" />
          </div>
          
          <div>
            <label class="label" style="margin-bottom: 6px; font-size: 12px; font-weight: 600; color: var(--muted); text-transform: uppercase; letter-spacing: 0.5px;">Database Name</label>
            <input type="text" id="reconnectDatabaseName" class="input" placeholder="OrbisHub" style="font-family: 'Courier New', monospace;" />
          </div>
        </div>
        
        <div>
          <label class="label" style="margin-bottom: 6px; font-size: 12px; font-weight: 600; color: var(--muted); text-transform: uppercase; letter-spacing: 0.5px;">Authentication</label>
          <select id="reconnectAuthType" class="input">
            <option value="windows">Windows Authentication</option>
            <option value="sql">SQL Server Authentication</option>
          </select>
        </div>
        
        <div id="reconnectSqlAuthContainer" style="display: none; grid-template-columns: 1fr 1fr; gap: 16px;">
          <div>
            <label class="label" style="margin-bottom: 6px; font-size: 12px; font-weight: 600; color: var(--muted); text-transform: uppercase; letter-spacing: 0.5px;">Username</label>
            <input type="text" id="reconnectUsername" class="input" placeholder="sa" style="font-family: 'Courier New', monospace;" />
          </div>
          
          <div>
            <label class="label" style="margin-bottom: 6px; font-size: 12px; font-weight: 600; color: var(--muted); text-transform: uppercase; letter-spacing: 0.5px;">Password</label>
            <input type="password" id="reconnectPassword" class="input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
          </div>
        </div>
        
        <div style="display: flex; gap: 20px; padding-top: 8px;">
          <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; color: var(--text); cursor: pointer;">
            <input type="checkbox" id="reconnectTrustCert" />
            <span>Trust Server Certificate</span>
          </label>
          <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; color: var(--text); cursor: pointer;">
            <input type="checkbox" id="reconnectEncrypt" />
            <span>Encrypt Connection</span>
          </label>
        </div>
      </div>
    </div>
    
    <div id="reconnectStatus" class="setup-status" style="display:none; margin-bottom: 20px;"></div>
    
    <menu class="row" style="gap: 8px; margin: 0; padding: 0; justify-content: center;">
      <button type="submit" value="cancel" class="btn btn-ghost">Cancel</button>
      <button type="button" id="reconnectTestBtn" class="btn btn-primary">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:6px;">
          <polyline points="23 4 23 10 17 10"></polyline>
          <polyline points="1 20 1 14 7 14"></polyline>
          <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
        </svg>
        Connect
      </button>
    </menu>
  </form>
</dialog>

<!-- Clear Configuration Confirmation Modal -->
<dialog id="clearConfigConfirmModal" class="modal">
  <div class="card" style="max-width: 480px; text-align: center;">
    <div style="width: 64px; height: 64px; border-radius: 16px; background: linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(220, 38, 38, 0.1) 100%); border: 2px solid rgba(239, 68, 68, 0.3); display: flex; align-items: center; justify-content: center; margin: 0 auto 20px;">
      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="15" y1="9" x2="9" y2="15"></line>
        <line x1="9" y1="9" x2="15" y2="15"></line>
      </svg>
    </div>
    
    <h2 style="margin: 0 0 12px 0; font-size: 20px; font-weight: 600;">Clear All Configuration?</h2>
    <p style="margin: 0 0 20px 0; color: var(--muted); font-size: 14px; line-height: 1.6;">
      This will delete your database connection settings and clear all saved credentials. The app will reset to its initial state.
    </p>
    
    <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 8px; padding: 16px; margin-bottom: 24px;">
      <p style="margin: 0; font-size: 13px; color: #fca5a5; text-align: left;">
        <strong style="display: block; margin-bottom: 8px;">This action will:</strong>
        ‚Ä¢ Delete database connection settings<br>
        ‚Ä¢ Clear saved credentials<br>
        ‚Ä¢ Reset the app to initial state
      </p>
    </div>
    
    <menu class="row" style="gap: 12px; margin: 0; padding: 0; justify-content: center;">
      <button type="button" id="clearConfigCancelBtn" class="btn btn-ghost" style="min-width: 120px;">Cancel</button>
      <button type="button" id="clearConfigConfirmBtn" class="btn btn-danger" style="min-width: 120px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white;">
        Clear Configuration
      </button>
    </menu>
  </div>
</dialog>

<!-- Password Change Modal -->
<dialog id="changePasswordModal" class="modal">
<div class="card">
<button type="button" class="modal-close-btn" title="Close" style="display:none;">
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
    <line x1="18" y1="6" x2="6" y2="18"></line>
    <line x1="6" y1="6" x2="18" y2="18"></line>
  </svg>
</button>
<h2>Change Password</h2>
<p class="muted" style="margin-bottom: 16px;">You must change your password before continuing.</p>
<div id="changePasswordError" class="login-error" style="margin-bottom: 16px;"></div>
<input type="hidden" id="changePasswordUserId" />
<label class="label">New Password
<input id="newPassword" type="password" class="input" placeholder="Enter new password" required />
</label>
<label class="label">Confirm Password
<input id="confirmPassword" type="password" class="input" placeholder="Confirm new password" required />
</label>
<menu class="row end">
<button id="changePasswordBtn" type="button" class="btn">Change Password</button>
</menu>
</div>
</dialog>

<!-- Sign Out Confirmation Modal -->
<dialog id="signOutModal" class="modal modal-confirm">
<form method="dialog" class="card">
<div class="modal-icon modal-icon-warning">
  <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4M16 17l5-5-5-5M21 12H9"/>
  </svg>
</div>
<h2 style="margin-top: 16px;">Sign Out</h2>
<p class="muted" style="margin-bottom: 24px;">Are you sure you want to end your session?</p>
<menu class="row end">
<button type="submit" value="cancel" class="btn btn-ghost">Cancel</button>
<button id="confirmSignOutBtn" type="submit" value="confirm" class="btn btn-danger">Sign Out</button>
</menu>
</form>
</dialog>

<!-- Exit Confirmation Modal -->
<dialog id="exitConfirmModal" class="modal modal-confirm">
<form method="dialog" class="card">
<div class="modal-icon modal-icon-danger">
  <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <circle cx="12" cy="12" r="10"></circle>
    <line x1="15" y1="9" x2="9" y2="15"></line>
    <line x1="9" y1="9" x2="15" y2="15"></line>
  </svg>
</div>
<h2 style="margin-top: 16px;">Close OrbisHub Desktop?</h2>
<p class="muted" style="margin-bottom: 24px;">Are you sure you want to close the application? All your data is saved automatically.</p>
<menu class="row end">
<button type="submit" value="cancel" class="btn btn-ghost">Cancel</button>
<button id="confirmExitBtn" type="submit" value="confirm" class="btn btn-danger">Close Application</button>
</menu>
</form>
</dialog>

<!-- Environment Details Modal -->
<dialog id="envDetailsModal" class="modal">
<form method="dialog" class="card" style="max-width: 700px; min-width: 600px;">
<button type="submit" value="close" class="modal-close-btn" title="Close">
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
    <line x1="18" y1="6" x2="6" y2="18"></line>
    <line x1="6" y1="6" x2="18" y2="18"></line>
  </svg>
</button>
<h2>Environment Details</h2>
<menu class="row" style="margin: 16px 0 24px 0; gap: 8px; padding: 0;">
<button type="button" id="envDetailsDeployBtn" class="btn" style="background: linear-gradient(135deg, #5a4fcf 0%, #5e2a84 100%); color: white; border: none;" data-permissions-any="environments:execute,*:*">Deploy</button>
<button type="button" id="envDetailsSolutionsBtn" class="btn" style="background: linear-gradient(135deg, #d946a6 0%, #c21e56 100%); color: white; border: none;">Show Solutions</button>
<button type="button" id="envDetailsMapServersBtn" class="btn" style="background: linear-gradient(135deg, #0ea770 0%, #0c8599 100%); color: white; border: none;" data-permissions-any="environments:edit,*:*">Map Agent</button>
</menu>
<div id="envDetailsContent" style="margin: 24px 0;">
  <!-- Details will be populated by JavaScript -->
</div>
</form>
</dialog>

<!-- Main Application (hidden until logged in) -->
<aside id="appSidebar" class="sidebar" style="display:none;">
<div class="brand">
  <img src="../media/logo.png" alt="OrbisHub logo" class="brand__logo">
  <div class="brand__name">OrbisHub</div>
</div>
<nav class="nav">
<div class="nav__group">
  <div class="nav__label">General</div>
  <button class="nav__btn is-active" data-view="summary">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:8px;">
      <rect x="3" y="3" width="7" height="7"></rect>
      <rect x="14" y="3" width="7" height="7"></rect>
      <rect x="14" y="14" width="7" height="7"></rect>
      <rect x="3" y="14" width="7" height="7"></rect>
    </svg>
    Summary
    <span id="summaryNotificationBadge" class="nav-badge" style="display:none;">!</span>
  </button>
</div>

<div class="nav__group">
  <div class="nav__label">System Administrators</div>
  <button class="nav__btn" data-view="agents">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:8px;">
      <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
      <line x1="8" y1="21" x2="16" y2="21"></line>
      <line x1="12" y1="17" x2="12" y2="21"></line>
    </svg>
    Orbis Agents
  </button>
  <button class="nav__btn" data-view="admin-users">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:8px;">
      <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
      <circle cx="9" cy="7" r="4"></circle>
      <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
      <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
    </svg>
    Users / Permissions
  </button>
  <button class="nav__btn" data-view="environments">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:8px;">
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="2" y1="12" x2="22" y2="12"></line>
      <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
    </svg>
    Farm Systems
  </button>
  <button class="nav__btn" data-view="servers">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:8px;">
      <rect x="2" y="2" width="20" height="8" rx="2" ry="2"></rect>
      <rect x="2" y="14" width="20" height="8" rx="2" ry="2"></rect>
      <line x1="6" y1="6" x2="6.01" y2="6"></line>
      <line x1="6" y1="18" x2="6.01" y2="18"></line>
    </svg>
    Remote Desktop Manager
  </button>
  <button class="nav__btn" data-view="admin-credentials">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:8px;">
      <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
      <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
    </svg>
    Credentials
  </button>
  <button class="nav__btn" data-view="admin-notifications" style="display:none;">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:8px;">
      <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
      <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
    </svg>
    Notifications
  </button>
  <button class="nav__btn" data-view="tickets">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:8px;">
      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
      <polyline points="14 2 14 8 20 8"></polyline>
      <line x1="16" y1="13" x2="8" y2="13"></line>
      <line x1="16" y1="17" x2="8" y2="17"></line>
      <line x1="12" y1="9" x2="8" y2="9"></line>
    </svg>
    Ticket Management
  </button>
  <button class="nav__btn" data-view="passwords" data-permissions-any="passwords:view,*:*">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:8px;">
      <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
      <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
      <circle cx="12" cy="16" r="1"></circle>
    </svg>
    Password Manager
  </button>
</div>

<div class="nav__group">
  <div class="nav__label">Monitoring</div>
  <button class="nav__btn" data-view="elasticsearch">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:8px;">
      <circle cx="11" cy="11" r="8"></circle>
      <path d="m21 21-4.35-4.35"></path>
    </svg>
    ElasticSearch(comming soon)
  </button>
</div>

<div class="nav__group">
  <div class="nav__label">Other</div>
  <button class="nav__btn" data-view="admin-audit">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:8px;">
      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
      <polyline points="14 2 14 8 20 8"></polyline>
      <line x1="16" y1="13" x2="8" y2="13"></line>
      <line x1="16" y1="17" x2="8" y2="17"></line>
      <polyline points="10 9 9 9 8 9"></polyline>
    </svg>
    Audit Logs
  </button>
  <button class="nav__btn" data-view="admin-documentation">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:8px;">
      <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
      <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
    </svg>
    Documentation
  </button>
  <button class="nav__btn" data-view="bug-report">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:8px;">
      <rect x="8" y="6" width="8" height="12" rx="2" ry="2"></rect>
      <line x1="4" y1="10" x2="4" y2="14"></line>
      <line x1="20" y1="10" x2="20" y2="14"></line>
      <line x1="8" y1="2" x2="16" y2="2"></line>
      <path d="M12 6v2"></path>
    </svg>
    Report a Bug
  </button>
</div>

<div class="nav__group nav__group--bottom">
  <div class="nav__label">System</div>
  <button class="nav__btn" id="configStatusNavBtn" data-view="system-configuration">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:8px;">
      <circle cx="12" cy="12" r="3"></circle>
      <path d="M12 1v6m0 6v6m-9-9h6m6 0h6"></path>
    </svg>
    System Configuration
    <span class="nav-badge" id="configNavBadge" style="display:none; margin-left:auto;">1</span>
    <span class="nav-badge" id="updateAvailableNavBadge" style="display:none; margin-left:auto; background:#f97316;">!</span>
  </button>
  <button class="nav__btn" data-view="settings">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:8px;">
      <circle cx="12" cy="12" r="3"></circle>
      <path d="M12 1v6m0 6v6"></path>
      <path d="m4.93 4.93 4.24 4.24m5.66 5.66 4.24 4.24"></path>
      <path d="M1 12h6m6 0h6"></path>
      <path d="m4.93 19.07 4.24-4.24m5.66-5.66 4.24-4.24"></path>
    </svg>
    Settings
  </button>
</div>
</nav>
</aside>


<main id="appMain" class="main" style="display:none;">
<header class="topbar">
<!-- Welcome Text -->
<div id="welcomeText" style="display:flex; align-items:center; gap:8px; margin-left:0; color:var(--text); font-size:14px;">
  <span style="color:var(--muted);">Welcome,</span>
  <span id="welcomeUserName" style="font-weight:600; color:var(--primary);">User</span>
</div>
<div style="flex:1"></div>
<!-- Messages Button -->
<button class="config-status-btn" data-view="messages" title="Messages" style="margin-right:12px;">
  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
  </svg>
  <!-- <span>Messages</span> -->
  <span class="nav-badge" id="navUnreadBadge" style="display:none;">0</span>
</button>
<div class="user-menu">
  <button class="user-menu__btn" id="userMenuBtn">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
      <circle cx="12" cy="7" r="4"></circle>
    </svg>
  </button>
  <div class="user-menu__dropdown" id="userMenuDropdown">
    <div class="user-menu__profile" id="userMenuProfile">
      <div class="user-menu__profile-name" id="userProfileName">Administrator</div>
      <div class="user-menu__profile-email" id="userProfileEmail">admin@orbis.com</div>
      <div class="user-menu__profile-role" id="userProfileRole">Super Admin</div>
    </div>
    <div class="user-menu__divider"></div>
    <button class="user-menu__item" id="viewProfileBtn">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
        <circle cx="12" cy="7" r="4"></circle>
      </svg>
      View Profile
    </button>
    <button class="user-menu__item" id="signOutBtn">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
        <polyline points="16 17 21 12 16 7"></polyline>
        <line x1="21" y1="12" x2="9" y2="12"></line>
      </svg>
      Sign Out
    </button>
  </div>
</div>
</header>
 
<div class="views">
<section id="view-summary" class="view">
<div class="view__header">
  <h1>Overview Dashboard</h1>
  <div style="flex:1"></div>
  <button class="btn btn-ghost" onclick="updateSummaryDashboard()">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <polyline points="23 4 23 10 17 10"></polyline>
      <polyline points="1 20 1 14 7 14"></polyline>
      <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
    </svg>
    Refresh
  </button>
</div>

<div class="stack">
  <!-- System Status Banner -->
  <div id="summaryStatusBanner" class="summary-status-banner">
    <div class="summary-status-banner__content">
      <div class="summary-status-banner__icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
        </svg>
      </div>
      <div class="summary-status-banner__info">
        <div class="summary-status-banner__title">System Status: <span id="summarySystemStatus">Loading...</span></div>
        <div class="summary-status-banner__subtitle">Last updated: <span id="summaryLastUpdate">Just now</span></div>
      </div>
    </div>
    <div class="summary-status-banner__health">
      <div class="summary-health-ring" id="summaryHealthRing">
        <svg width="80" height="80" viewBox="0 0 80 80">
          <circle cx="40" cy="40" r="32" fill="none" stroke="var(--border)" stroke-width="6"></circle>
          <circle id="summaryHealthCircle" cx="40" cy="40" r="32" fill="none" stroke="#10b981" stroke-width="6" stroke-dasharray="201 201" stroke-dashoffset="0" stroke-linecap="round" transform="rotate(-90 40 40)"></circle>
        </svg>
        <div class="summary-health-ring__percentage" id="summaryHealthPercentage">--</div>
      </div>
    </div>
  </div>

  <!-- Key Metrics Grid -->
  <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(240px, 1fr)); gap:20px; margin-bottom:24px;">
    <!-- Environments Card -->
    <div class="summary-metric-card summary-metric-card--blue">
      <div class="summary-metric-card__header">
        <div class="summary-metric-card__icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="2" y1="12" x2="22" y2="12"></line>
            <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
          </svg>
        </div>
        <div class="summary-metric-card__trend" id="summaryEnvTrend">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2">
            <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
          </svg>
        </div>
      </div>
      <div class="summary-metric-card__value" id="summaryEnvCount">0</div>
      <div class="summary-metric-card__label">Farm Systems</div>
      <div class="summary-metric-card__details">
        <div class="summary-metric-detail">
          <span class="summary-metric-detail__label">Healthy</span>
          <span class="summary-metric-detail__value summary-metric-detail__value--success" id="summaryEnvHealthy">0</span>
        </div>
        <div class="summary-metric-detail">
          <span class="summary-metric-detail__label">Issues</span>
          <span class="summary-metric-detail__value summary-metric-detail__value--error" id="summaryEnvIssues">0</span>
        </div>
      </div>
      <div class="summary-metric-card__progress">
        <div class="summary-metric-card__progress-bar" id="summaryEnvHealthBar" style="width:100%"></div>
      </div>
    </div>
    
    <!-- Servers Card -->
    <div class="summary-metric-card summary-metric-card--green">
      <div class="summary-metric-card__header">
        <div class="summary-metric-card__icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="2" y="2" width="20" height="8" rx="2" ry="2"></rect>
            <rect x="2" y="14" width="20" height="8" rx="2" ry="2"></rect>
            <line x1="6" y1="6" x2="6.01" y2="6"></line>
            <line x1="6" y1="18" x2="6.01" y2="18"></line>
          </svg>
        </div>
        <div class="summary-metric-card__trend" id="summaryServerTrend">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2">
            <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
          </svg>
        </div>
      </div>
      <div class="summary-metric-card__value" id="summaryServerCount">0</div>
      <div class="summary-metric-card__label">Servers</div>
      <div class="summary-metric-card__details">
        <div class="summary-metric-detail">
          <span class="summary-metric-detail__label">Online</span>
          <span class="summary-metric-detail__value summary-metric-detail__value--success" id="summaryServerOnline">0</span>
        </div>
        <div class="summary-metric-detail">
          <span class="summary-metric-detail__label">Offline</span>
          <span class="summary-metric-detail__value summary-metric-detail__value--muted" id="summaryServerOffline">0</span>
        </div>
      </div>
      <div class="summary-metric-card__progress">
        <div class="summary-metric-card__progress-bar" id="summaryServerHealthBar" style="width:100%"></div>
      </div>
    </div>

    <!-- Agents Card -->
    <div class="summary-metric-card summary-metric-card--purple">
      <div class="summary-metric-card__header">
        <div class="summary-metric-card__icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
            <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
            <line x1="12" y1="22.08" x2="12" y2="12"></line>
          </svg>
        </div>
        <div class="summary-metric-card__trend" id="summaryAgentTrend">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2">
            <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
          </svg>
        </div>
      </div>
      <div class="summary-metric-card__value" id="summaryAgentCount">0</div>
      <div class="summary-metric-card__label">Agents</div>
      <div class="summary-metric-card__details">
        <div class="summary-metric-detail">
          <span class="summary-metric-detail__label">Active</span>
          <span class="summary-metric-detail__value summary-metric-detail__value--success" id="summaryAgentActive">0</span>
        </div>
        <div class="summary-metric-detail">
          <span class="summary-metric-detail__label">Inactive</span>
          <span class="summary-metric-detail__value summary-metric-detail__value--muted" id="summaryAgentInactive">0</span>
        </div>
      </div>
      <div class="summary-metric-card__progress">
        <div class="summary-metric-card__progress-bar" id="summaryAgentHealthBar" style="width:100%"></div>
      </div>
    </div>

    <!-- Credentials Card -->
    <div class="summary-metric-card summary-metric-card--orange">
      <div class="summary-metric-card__header">
        <div class="summary-metric-card__icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
          </svg>
        </div>
        <div class="summary-metric-card__trend" id="summaryCredTrend">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2">
            <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
          </svg>
        </div>
      </div>
      <div class="summary-metric-card__value" id="summaryCredCount">0</div>
      <div class="summary-metric-card__label">Credentials</div>
      <div class="summary-metric-card__details">
        <div class="summary-metric-detail">
          <span class="summary-metric-detail__label">Valid</span>
          <span class="summary-metric-detail__value summary-metric-detail__value--success" id="summaryCredValid">0</span>
        </div>
        <div class="summary-metric-detail">
          <span class="summary-metric-detail__label">Types</span>
          <span class="summary-metric-detail__value summary-metric-detail__value--info" id="summaryCredTypes">0</span>
        </div>
      </div>
      <div class="summary-metric-card__progress">
        <div class="summary-metric-card__progress-bar" id="summaryCredHealthBar" style="width:100%"></div>
      </div>
    </div>
  </div>

  <!-- Two Column Layout for Activity and Quick Actions -->
  <div style="display:grid; grid-template-columns:2fr 1fr; gap:20px; margin-bottom:24px;">
    <!-- Recent Activity -->
    <div class="card">
      <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:16px;">
        <h3 style="margin:0;">Recent Activity</h3>
        <div style="display:flex; gap:8px;">
          <button class="btn btn-ghost btn-sm" onclick="filterSummaryActivity('all')" id="activityFilterAll">All</button>
          <button class="btn btn-ghost btn-sm" onclick="filterSummaryActivity('environments')" id="activityFilterEnv">Farm Systems</button>
          <button class="btn btn-ghost btn-sm" onclick="filterSummaryActivity('servers')" id="activityFilterSrv">Servers</button>
        </div>
      </div>
      <div id="summaryRecentActivity" style="max-height:400px; overflow-y:auto;">
        <p class="muted">No recent activity</p>
      </div>
    </div>
    
    <!-- Quick Actions & Stats -->
    <div class="stack" style="gap:20px;">
      <!-- Quick Actions -->
      <div class="card">
        <h3 style="margin-bottom:16px;">Quick Actions</h3>
        <div style="display:flex; flex-direction:column; gap:8px;">
          <button class="btn btn-ghost" style="justify-content:flex-start;" onclick="showView('environments'); document.getElementById('addEnvBtn').click();">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="8" x2="12" y2="16"></line>
              <line x1="8" y1="12" x2="16" y2="12"></line>
            </svg>
            Add Farm System
          </button>
          <button class="btn btn-ghost" style="justify-content:flex-start;" onclick="showView('servers'); document.getElementById('addServerBtn').click();">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="2" y="2" width="20" height="8" rx="2" ry="2"></rect>
              <line x1="12" y1="6" x2="12" y2="6"></line>
            </svg>
            Add Server
          </button>
          <button class="btn btn-ghost" style="justify-content:flex-start;" onclick="showView('agents')">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
            </svg>
            View Agents
          </button>
          <!-- Admin Panel button removed - no longer in use -->
        </div>
      </div>

      <!-- System Info -->
      <div class="card">
        <h3 style="margin-bottom:16px;">System Info</h3>
        <div style="display:flex; flex-direction:column; gap:12px; font-size:13px;">
          <div style="display:flex; justify-content:space-between;">
            <span style="color:var(--muted);">Database</span>
            <span style="font-weight:600;" id="summaryDbStatus">Connected</span>
          </div>
          <div style="display:flex; justify-content:space-between;">
            <span style="color:var(--muted);">OrbisHub.Core</span>
            <span style="font-weight:600;" id="summaryCoreStatus">Checking...</span>
          </div>
          <div style="display:flex; justify-content:space-between;">
            <span style="color:var(--muted);">Users</span>
            <span style="font-weight:600;" id="summaryUserCount">0</span>
          </div>
          <div style="display:flex; justify-content:space-between;">
            <span style="color:var(--muted);">DB Size</span>
            <span style="font-weight:600;" id="summaryDbSize">-</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- System Logs (shown when errors detected) -->
  <div id="summaryErrorLogsContainer" class="card" style="display:none; border-left:3px solid #ef4444;">
    <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:16px;">
      <div style="display:flex; align-items:center; gap:12px;">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="12"></line>
          <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
        <h3 style="margin:0; color:#ef4444;">System Errors Detected</h3>
      </div>
      <button class="btn btn-ghost btn-sm" onclick="document.getElementById('summaryErrorLogsContainer').style.display='none'">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
        Dismiss
      </button>
    </div>
    <div id="summaryErrorLogs" style="background:var(--bg); border:1px solid var(--border); border-radius:8px; padding:16px; max-height:300px; overflow-y:auto; font-family:monospace; font-size:12px; line-height:1.6;">
      <div class="muted">Checking for errors...</div>
    </div>
  </div>
</div>
</section>

<section id="view-environments" class="view">
<div class="view__header">
  <h1>Farm Systems</h1>
  <div style="flex:1"></div>
  <button id="refreshEnvBtn" class="btn btn-ghost" title="Refresh health and agent uptimes">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <polyline points="23 4 23 10 17 10"></polyline>
      <polyline points="1 20 1 14 7 14"></polyline>
      <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
    </svg>
    Refresh
  </button>
  <button id="addEnvBtn" class="btn" data-permissions-any="environments:create,*:*">+ Add Farm System</button>
  
</div>
<div class="view__toolbar">
  <input id="search" class="input" placeholder="Search farm systems by name or URL..." style="flex:1; max-width: 600px;" />
</div>
<div class="stack">
  <div id="envList" class="grid"></div>
</div>
</section>

<!-- ElasticSearch View -->
<section id="view-elasticsearch" class="view">
  <div class="view__header">
    <h1>ElasticSearch</h1>
    <div style="flex:1"></div>
    <button class="btn btn-ghost">Configure</button>
  </div>
  <div class="stack">
    <p class="muted">ElasticSearch logs and analytics viewer.</p>
  </div>
</section>


<!-- Admin Panel view removed - no longer in use -->

<!-- Agents Management -->
<section id="view-agents" class="view">
  <div class="view__header">
    <h1>Agent Management</h1>
    <div style="flex:1"></div>
    <div style="display:flex; gap:12px;">
      <span id="agentsOnlineCount" class="badge" style="background:#10b98120; color:#10b981; font-weight:600;">0 Online</span>
      <span id="agentsOfflineCount" class="badge" style="background:#ef444420; color:#ef4444; font-weight:600;">0 Offline</span>
      <button class="btn btn-ghost" onclick="AgentUI.showDeploymentGuide()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
          <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
          <line x1="12" y1="22.08" x2="12" y2="12"></line>
        </svg>
        Deploy Agent
      </button>
    </div>
  </div>

  <!-- Search Filter -->
  <div style="margin-bottom: 20px;">
    <div class="agent-search-container">
      <svg class="agent-search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="11" cy="11" r="8"></circle>
        <path d="m21 21-4.35-4.35"></path>
      </svg>
      <input 
        type="text" 
        id="agentSearchInput" 
        class="agent-search-input" 
        placeholder="Search agents by name, IP, OS, or user..." 
        oninput="AgentUI.filterAgents(this.value)"
      />
      <button class="agent-search-clear" id="agentSearchClear" onclick="AgentUI.clearSearch()" style="display:none;">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
  </div>

  <div class="stack">
    <div id="agentsList" style="display:grid; grid-template-columns:repeat(auto-fill, minmax(380px, 1fr)); gap:20px;">
      <!-- Agent cards will be rendered here by AgentUI.renderAgentsDashboard() -->
    </div>
    <div id="agentsNoResults" class="agent-no-results" style="display:none;">
      <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <circle cx="11" cy="11" r="8"></circle>
        <path d="m21 21-4.35-4.35"></path>
      </svg>
      <h3>No agents found</h3>
      <p>Try adjusting your search terms</p>
    </div>
  </div>
</section>

<!-- Admin Users Management -->
<section id="view-admin-users" class="view">
  <div class="view__header">
    <h1>User Management & Permissions</h1>
    <div style="flex:1"></div>
    <!-- <button id="backToAdminBtn" class="btn btn-ghost">‚Üê Back to Admin</button> -->
    <button id="addUserBtn" class="btn" data-permissions-any="users:create,*:*">+ Create User</button>
  </div>
  
  <!-- Tab Navigation -->
  <div class="tab-nav" style="display: flex; gap: 8px; border-bottom: 2px solid var(--border); margin-bottom: 24px;">
    <button class="tab-btn active" data-tab="users-tab" style="padding: 12px 24px; background: none; border: none; border-bottom: 2px solid transparent; cursor: pointer; font-weight: 600; color: var(--muted); transition: all 0.2s;">
      Users
    </button>
    <button class="tab-btn" data-tab="permissions-tab" data-permissions-any="roles:view,*:*" style="padding: 12px 24px; background: none; border: none; border-bottom: 2px solid transparent; cursor: pointer; font-weight: 600; color: var(--muted); transition: all 0.2s;">
      Permissions
    </button>
  </div>
  
  <!-- Users Tab Content -->
  <div id="users-tab" class="tab-content" style="display: block;">
    <div class="card">
      <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
        <h3>Users</h3>
        <select id="userRoleFilter" class="input" style="width: 150px;">
          <option value="">All Roles</option>
          <option value="admin">Admin</option>
          <option value="operator">Operator</option>
          <option value="viewer">Viewer</option>
        </select>
      </div>
      <div id="userList" class="stack" style="margin-top:12px;"></div>
    </div>
  </div>

  <!-- Permissions Tab Content - Dynamic UI rendered by permissions-manager-ui.js -->
  <div id="permissions-tab" class="tab-content" style="display: none;">
    <!-- Permissions Manager will render here dynamically -->
  </div>
</section>


<section id="view-servers" class="view">
<div class="view__header">
  <h1>Remote Desktop Manager</h1>
  <div style="flex:1"></div>
  <button id="checkServerHealthBtn" class="btn btn-ghost" style="margin-right: 8px;">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:6px;">
      <polyline points="23 4 23 10 17 10"></polyline>
      <polyline points="1 20 1 14 7 14"></polyline>
      <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
    </svg>
    Check Health
  </button>
  <button id="addServerBtn" class="btn" data-permissions-any="servers:create,*:*">+ Add Server</button>
</div>
<div class="view__toolbar">
  <input id="serverSearchInput" class="input" placeholder="Search servers by name, host, or environment..." style="flex: 1; max-width: 600px;" />
</div>
<div class="stack">
  <p class="muted" style="margin-bottom:20px;">Manage your remote servers and connect using saved credentials. Click on server icons to establish remote desktop connections.</p>
  <div id="serversList" class="grid"></div>
</div>
</section>

<!-- Admin Credentials Management -->
<section id="view-admin-credentials" class="view">
  <div class="view__header">
    <h1>Credentials Management</h1>
    <div style="flex:1"></div>
    <button id="addCredentialBtn" class="btn" data-permissions-any="credentials:create,*:*">+ Add Credential</button>
  </div>
  <div class="view__toolbar">
    <input id="credentialSearchInput" class="input" placeholder="Search credentials..." />
  </div>
  <div id="credentialList" class="grid"></div>
</section>

<!-- Credentials: Add Modal -->
<dialog id="credentialModal" class="modal">
  <form method="dialog" class="card">
    <button type="submit" value="cancel" class="modal-close-btn" title="Close">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
    <h2>Add Credential</h2>
    <label class="label">Name
      <input id="credName" class="input" placeholder="e.g., Prod RDP" required />
    </label>
    <label class="label">Type
      <select id="credType" class="input">
        <option value="Username/Password">Username/Password</option>
      </select>
    </label>
    <label class="label">Username
      <input id="credUsername" class="input" placeholder="DOMAIN\\user or user" />
    </label>
    <label class="label">Password
      <input id="credPassword" type="password" class="input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
    </label>
    <label class="label">Preferred Machine (Optional)
      <select id="credPreferredMachine" class="input">
        <option value="">-- Available for all servers --</option>
      </select>
      <span class="input-hint">Restrict this credential to a specific server</span>
    </label>
    <label class="label">Description
      <input id="credDescription" class="input" placeholder="Optional" />
    </label>
    <menu class="row end">
      <button id="saveCredBtn" type="submit" value="default" class="btn">Save Credential</button>
    </menu>
  </form>
  </dialog>

<!-- Credentials: Edit Modal -->
<dialog id="editCredentialModal" class="modal">
  <form method="dialog" class="card">
    <button type="submit" value="cancel" class="modal-close-btn" title="Close">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
    <h2>Edit Credential</h2>
    <input type="hidden" id="editCredId" />
    <label class="label">Name
      <input id="editCredName" class="input" required />
    </label>
    <label class="label">Type
      <select id="editCredType" class="input">
        <option value="Username/Password">Username/Password</option>
      </select>
    </label>
    <label class="label">Username
      <input id="editCredUsername" class="input" />
    </label>
    <label class="label">Password (leave blank to keep)
      <input id="editCredPassword" type="password" class="input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
    </label>
    <label class="label">Preferred Machine (Optional)
      <select id="editCredPreferredMachine" class="input">
        <option value="">-- Available for all servers --</option>
      </select>
      <span class="input-hint">Restrict this credential to a specific server</span>
    </label>
    <label class="label">Description
      <input id="editCredDescription" class="input" />
    </label>
    <menu class="row end">
      <button id="saveEditCredBtn" type="submit" value="default" class="btn">Save Changes</button>
    </menu>
  </form>
  </dialog>

<!-- Credentials: Delete Confirmation Modal -->
<dialog id="deleteCredentialModal" class="modal">
  <form method="dialog" class="card" style="max-width:560px;">
    <div style="display:flex; align-items:center; gap:16px; margin-bottom:16px;">
      <div style="width:48px; height:48px; border-radius:12px; background:rgba(239,68,68,0.1); display:flex; align-items:center; justify-content:center; flex-shrink:0;">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
          <line x1="12" y1="9" x2="12" y2="13"></line>
          <line x1="12" y1="17" x2="12.01" y2="17"></line>
        </svg>
      </div>
      <div style="flex:1;">
        <h2 style="margin:0 0 4px 0;">Delete Credential?</h2>
        <p class="muted" style="margin:0; font-size:14px;">This will unassign the credential from all servers.</p>
      </div>
    </div>
    <div style="background:var(--bg-secondary); border:1px solid var(--border); border-radius:8px; padding:12px; margin-bottom:16px;">
      <div style="font-size:13px; color:var(--muted); margin-bottom:8px;">Credential</div>
      <div style="font-weight:600;" id="deleteCredName">-</div>
      <div style="display:flex; gap:16px; margin-top:12px; font-size:13px;">
        <div>Servers using: <strong id="deleteCredUsageServers">0</strong></div>
      </div>
      <div id="deleteCredUsageDetails" style="margin-top:8px; max-height:140px; overflow:auto; font-size:12px; color:var(--muted);"></div>
    </div>
    <menu class="row end">
      <button value="cancel" class="btn btn-ghost">Cancel</button>
      <button id="confirmDeleteCredBtn" type="submit" value="default" class="btn btn-danger">Delete Credential</button>
    </menu>
  </form>
  </dialog>

<!-- Admin Audit Logs -->
<section id="view-admin-audit" class="view">
  <div class="view__header">
    <h1>Audit Logs</h1>
  </div>
  <div class="view__toolbar" style="gap:12px; display:flex; align-items:center;">
    <input id="auditSearchInput" class="input" placeholder="Search by user, entity, or action..." style="max-width:400px;" />
    <select id="auditActionFilter" class="input" style="width:150px;">
      <option value="">All Actions</option>
      <option value="create">Create</option>
      <option value="update">Update</option>
      <option value="delete">Delete</option>
      <option value="run">Run</option>
    </select>
    <select id="auditEntityFilter" class="input" style="width:150px;">
      <option value="">All Types</option>
      <option value="environment">Farm Systems</option>
      <option value="user">Users</option>
      <option value="database">Databases</option>
      <option value="credential">Credentials</option>
      
      <option value="server">Servers</option>
    </select>
    <div style="flex:1"></div>
    <button id="clearAuditBtn" class="btn btn-ghost" style="color:#ef4444;" data-permissions-any="audit:delete,*:*">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="3 6 5 6 21 6"></polyline>
        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
        <line x1="10" y1="11" x2="10" y2="17"></line>
        <line x1="14" y1="11" x2="14" y2="17"></line>
      </svg>
      Clear History
    </button>
    <button id="refreshAuditBtn" class="btn btn-ghost">
      <svg id="refreshAuditIcon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="23 4 23 10 17 10"></polyline>
        <polyline points="1 20 1 14 7 14"></polyline>
        <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
      </svg>
      Refresh
    </button>
  </div>
  <div style="overflow-x:auto;">
    <table id="auditLogsTable" class="audit-table">
      <thead>
        <tr>
          <th>Timestamp</th>
          <th>User</th>
          <th>Action</th>
          <th>Entity Type</th>
          <th>Entity Name</th>
          <th>IP Address</th>
          <th>Details</th>
        </tr>
      </thead>
      <tbody id="auditLogsTableBody">
        <tr>
          <td colspan="7" style="text-align:center; padding:40px; color:var(--muted);">No audit logs yet</td>
        </tr>
      </tbody>
    </table>
  </div>
  
  <!-- Pagination Controls -->
  <div id="auditPaginationContainer" class="pagination-container" style="display: none;">
    <div class="pagination-info">
      <span id="auditPageInfo">Showing 0-0 of 0 entries</span>
      <select id="auditPageSize" class="pagination-select">
        <option value="10">10 per page</option>
        <option value="25" selected>25 per page</option>
        <option value="50">50 per page</option>
        <option value="100">100 per page</option>
      </select>
    </div>
    <div class="pagination-controls">
      <button id="auditFirstPageBtn" class="pagination-btn" title="First page">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polygon points="11,19 2,12 11,5 11,19"></polygon>
          <line x1="22" y1="5" x2="22" y2="19"></line>
        </svg>
      </button>
      <button id="auditPrevPageBtn" class="pagination-btn" title="Previous page">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="15,18 9,12 15,6"></polyline>
        </svg>
      </button>
      <div class="pagination-pages" id="auditPaginationPages">
        <button class="pagination-page active">1</button>
      </div>
      <button id="auditNextPageBtn" class="pagination-btn" title="Next page">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="9,18 15,12 9,6"></polyline>
        </svg>
      </button>
      <button id="auditLastPageBtn" class="pagination-btn" title="Last page">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polygon points="13,5 22,12 13,19 13,5"></polygon>
          <line x1="2" y1="5" x2="2" y2="19"></line>
        </svg>
      </button>
    </div>
  </div>
  
  <!-- Audit Log Detail Modal -->
  <div id="auditDetailModal" class="audit-detail-modal" style="display: none;" onclick="if(event.target === this) closeAuditDetailModal()">
    <div class="audit-detail-modal-content">
      <div class="audit-detail-modal-header">
        <h3>Audit Log Details</h3>
        <button class="btn-icon" onclick="closeAuditDetailModal()" title="Close">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div id="auditDetailContainer" class="audit-detail-body">
        <!-- Audit details will be rendered here -->
      </div>
    </div>
  </div>
</section>

<!-- Messages View (Slack/Teams-like) -->
<section id="view-messages" class="view">
  <div class="messages-layout">
    <!-- Left Sidebar: Conversations & Channels -->
    <aside class="messages-sidebar">
      <div class="messages-sidebar-header">
        <h2 class="messages-sidebar-title">Messages</h2>
        <button id="newMessageBtn" class="icon-btn" title="New message">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            <line x1="9" y1="10" x2="15" y2="10"></line>
            <line x1="12" y1="7" x2="12" y2="13"></line>
          </svg>
        </button>
      </div>
      
      <!-- Tabs for DMs and Channels -->
      <div class="messages-tabs">
        <button class="messages-tab active" data-tab="direct">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
          </svg>
          Direct Messages
        </button>
        <button class="messages-tab" data-tab="channels">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
          </svg>
          Channels
        </button>
      </div>
      
      <!-- Search -->
      <div class="messages-search">
        <svg class="messages-search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.35-4.35"></path>
        </svg>
        <input type="text" id="messagesSearchInput" class="input messages-search-input" placeholder="Search conversations..." />
      </div>
      
      <!-- Direct Messages List -->
      <div id="directMessagesList" class="messages-list">
        <div class="messages-list-empty">
          <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
          </svg>
          <p>No conversations yet</p>
          <small>Start a new message to begin</small>
        </div>
      </div>
      
      <!-- Channels List -->
      <div id="channelsList" class="messages-list" style="display:none;">
        <button id="createChannelBtnSidebar" class="messages-create-channel-btn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          Create a channel
        </button>
        <div class="messages-list-empty" style="display:none;">
          <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
          </svg>
          <p>No channels yet</p>
          <small>Create a channel to collaborate with your team</small>
        </div>
      </div>
    </aside>
    
    <!-- Main Chat Area -->
    <main class="messages-main">
      <!-- No Conversation Selected -->
      <div id="messagesEmptyState" class="messages-empty-state">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
        </svg>
        <h3>Select a conversation</h3>
        <p>Choose a conversation from the sidebar or start a new one</p>
      </div>
      
      <!-- Active Conversation -->
      <div id="messagesActiveChat" class="messages-active-chat" style="display:none;">
        <!-- Chat Header -->
        <header class="messages-chat-header">
          <div class="messages-chat-header-user">
            <div class="messages-avatar" id="activeChatAvatar">
              <span id="activeChatAvatarText"></span>
              <div class="messages-avatar-status" id="activeChatStatus"></div>
            </div>
            <div class="messages-chat-header-info">
              <h3 id="activeChatName">User Name</h3>
              <p id="activeChatMeta">Last seen recently</p>
            </div>
          </div>
          <div class="messages-chat-header-actions">
            <button class="icon-btn" title="Search in conversation">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
              </svg>
            </button>
            <button class="icon-btn" title="Conversation info">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="16" x2="12" y2="12"></line>
                <line x1="12" y1="8" x2="12.01" y2="8"></line>
              </svg>
            </button>
          </div>
        </header>
        
        <!-- Messages Container -->
        <div class="messages-chat-body" id="messagesChatBody">
          <!-- Messages will be rendered here -->
        </div>
        
        <!-- Message Input -->
        <footer class="messages-chat-footer">
          <div id="messagesTypingIndicator" class="messages-typing-indicator" style="display:none;">
            <div class="messages-typing-dots">
              <span></span><span></span><span></span>
            </div>
            <span id="messagesTypingUser">Someone</span> is typing...
          </div>
          <div class="messages-input-wrapper">
            <button class="icon-btn" title="Attach file">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path>
              </svg>
            </button>
            <button class="icon-btn" title="Add emoji">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>
                <line x1="9" y1="9" x2="9.01" y2="9"></line>
                <line x1="15" y1="9" x2="15.01" y2="9"></line>
              </svg>
            </button>
            <textarea 
              id="messagesTextarea" 
              class="messages-input" 
              placeholder="Type a message..." 
              rows="1"></textarea>
            <button id="messagesSendBtn" class="messages-send-btn" title="Send message">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
              </svg>
            </button>
          </div>
        </footer>
      </div>
    </main>
  </div>
</section>

<!-- Database Setup view removed - no longer in use -->

<!-- Ticket Management System -->
<section id="view-tickets" class="view">
  <div class="ticket-container">
    <!-- Header with search and filters -->
    <div class="ticket-header">
      <div class="ticket-header-left">
        <div class="ticket-search-box">
          <svg class="ticket-search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
          <input type="text" id="ticketSearch" placeholder="Search tickets...">
        </div>
      </div>
      <div class="ticket-filter-group">
        <button class="ticket-filter-btn" id="refreshTicketsBtn" title="Refresh">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="23 4 23 10 17 10"></polyline>
            <polyline points="1 20 1 14 7 14"></polyline>
            <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
          </svg>
        </button>
        <button class="btn" id="createTicketBtn" style="background: var(--primary); color: white; border: none;">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 6px;">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          Create Ticket
        </button>
      </div>
    </div>

    <!-- Statistics -->
    <div class="ticket-stats" id="ticketStatsContainer">
      <div class="ticket-stat-card">
        <div class="ticket-stat-label">Loading...</div>
        <div class="ticket-stat-value">0</div>
      </div>
    </div>

    <!-- Ticket List -->
    <div class="ticket-list-container" id="ticketListContainer">
      <div style="padding:40px; text-align:center; color:var(--muted);">
        Loading tickets...
      </div>
    </div>
  </div>
</section>

<!-- Password Manager -->
<section id="view-passwords" class="view">
  <div class="password-container">
    <!-- Sidebar -->
    <aside class="password-sidebar">
      <div class="password-sidebar-header">
        <div class="password-sidebar-title">
          üîê Password Manager
        </div>
        <div class="password-search">
          <svg class="password-search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
          <input type="text" id="passwordSearchInput" placeholder="Search passwords...">
        </div>
      </div>

      <div class="password-filters">
        <div class="password-filter-header">
          <div class="password-filter-label">Categories</div>
          <button class="btn-icon btn-icon-sm" id="manageCategoriesBtn" title="Manage Categories" data-permissions-any="passwords:edit,*:*">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="3"></circle>
              <path d="M12 1v6m0 6v6M5.64 5.64l4.24 4.24m4.24 4.24l4.24 4.24M1 12h6m6 0h6M5.64 18.36l4.24-4.24m4.24-4.24l4.24-4.24"></path>
            </svg>
          </button>
        </div>
        <div class="password-category-list" id="passwordCategoryList">
          <!-- Categories will be rendered here -->
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="password-main">
      <div class="password-header">
        <div class="password-header-title">Passwords</div>
        <div class="password-header-actions">
          <button class="btn btn-secondary" id="passwordFavoritesFilter">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
            </svg>
            Favorites
          </button>
          <button class="btn btn-primary" id="addPasswordBtn" data-permissions-any="passwords:create,*:*">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            Add Password
          </button>
        </div>
      </div>

      <div class="password-content">
        <div class="password-list-container" id="passwordListContainer">
          <!-- Password table will be rendered here -->
        </div>
        <div class="password-detail-panel" id="passwordDetailPanel" style="display: none;" onclick="if(event.target === this) window.PasswordUI.closePasswordDetail()">
          <div class="password-detail-panel-content">
            <div class="password-detail-panel-header">
              <h3>Password Details</h3>
              <button class="btn-icon" onclick="window.PasswordUI.closePasswordDetail()" title="Close">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
              </button>
            </div>
            <div id="passwordDetailContainer">
              <!-- Password details will be rendered here -->
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Manage Categories Modal -->
  <div id="manageCategoriesModal" class="password-modal" style="display: none;">
    <div class="password-modal-overlay"></div>
    <div class="password-modal-content" style="max-width: 700px;">
      <div class="password-modal-header">
        <h2>Manage Categories</h2>
        <button class="password-modal-close" onclick="window.PasswordUI.closeCategoryModal()">√ó</button>
      </div>
      <div class="password-modal-body">
        <div style="margin-bottom: 20px;">
          <button class="btn btn-primary" onclick="window.PasswordUI.addNewCategory()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            Add Category
          </button>
        </div>
        <div id="categoryListEdit">
          <!-- Category list will be rendered here -->
        </div>
      </div>
    </div>
  </div>

  <!-- Category Edit Modal -->
  <div id="categoryEditModal" class="password-modal" style="display: none;">
    <div class="password-modal-overlay"></div>
    <div class="password-modal-content" style="max-width: 500px;">
      <div class="password-modal-header">
        <h2 id="categoryModalTitle">Add Category</h2>
        <button class="password-modal-close" onclick="window.PasswordUI.closeCategoryEditModal()">√ó</button>
      </div>
      <div class="password-modal-body">
        <input type="hidden" id="categoryEditId">
        <div class="form-group">
          <label>Category Name</label>
          <input type="text" id="categoryEditName" class="input" placeholder="e.g., Banking" required>
        </div>
        <div class="form-group">
          <label>Icon</label>
          <select id="categoryEditIcon" class="input" required>
            <option value="üë§">üë§ Personal</option>
            <option value="üíº">üíº Work</option>
            <option value="üí≥">üí≥ Financial</option>
            <option value="üì±">üì± Social Media</option>
            <option value="üìß">üìß Email</option>
            <option value="üíª">üíª Development</option>
            <option value="üóÑÔ∏è">üóÑÔ∏è Database</option>
            <option value="üñ•Ô∏è">üñ•Ô∏è Server</option>
            <option value="üìù">üìù Other</option>
          </select>
        </div>
      </div>
      <div class="password-modal-footer">
        <button class="btn btn-secondary" onclick="window.PasswordUI.closeCategoryEditModal()">Cancel</button>
        <button class="btn btn-primary" onclick="window.PasswordUI.saveCategoryEdit()">Save</button>
      </div>
    </div>
  </div>

  <!-- Delete Password Confirmation Modal -->
  <div id="deletePasswordConfirmModal" class="password-modal" style="display: none;">
    <div class="password-modal-overlay"></div>
    <div class="password-modal-content" style="max-width: 480px;">
      <div class="password-modal-header" style="border-bottom: none; padding-bottom: 0;">
        <button class="password-modal-close" onclick="window.PasswordUI.closeDeletePasswordModal()" style="margin-left: auto;">√ó</button>
      </div>
      <div class="password-modal-body" style="text-align: center; padding-top: 0;">
        <div style="width: 64px; height: 64px; border-radius: 16px; background: linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(220, 38, 38, 0.1) 100%); border: 2px solid rgba(239, 68, 68, 0.3); display: flex; align-items: center; justify-content: center; margin: 0 auto 20px;">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2">
            <polyline points="3 6 5 6 21 6"></polyline>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
          </svg>
        </div>
        <h2 style="margin: 0 0 12px 0; font-size: 20px; font-weight: 600;">Delete Password?</h2>
        <p style="margin: 0 0 20px 0; color: var(--muted); font-size: 14px; line-height: 1.6;">
          This will permanently delete this password entry. This action cannot be undone.
        </p>
        <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 8px; padding: 16px; margin-bottom: 24px; text-align: left;">
          <p style="margin: 0; font-size: 13px; color: #fca5a5;">
            <strong style="display: block; margin-bottom: 8px;">‚ö†Ô∏è Warning</strong>
            This password will be permanently removed from the database and cannot be recovered.
          </p>
        </div>
      </div>
      <div class="password-modal-footer" style="gap: 12px; justify-content: center;">
        <button class="btn btn-secondary" onclick="window.PasswordUI.closeDeletePasswordModal()" style="min-width: 120px;">Cancel</button>
        <button class="btn btn-danger" onclick="window.PasswordUI.confirmDeletePassword()" id="deletePasswordConfirmBtn" style="min-width: 120px;">Delete</button>
      </div>
    </div>
  </div>

  <!-- Delete Category Confirmation Modal -->
  <div id="deleteCategoryConfirmModal" class="password-modal" style="display: none;">
    <div class="password-modal-overlay"></div>
    <div class="password-modal-content" style="max-width: 480px;">
      <div class="password-modal-header" style="border-bottom: none; padding-bottom: 0;">
        <button class="password-modal-close" onclick="window.PasswordUI.closeDeleteCategoryModal()" style="margin-left: auto;">√ó</button>
      </div>
      <div class="password-modal-body" style="text-align: center; padding-top: 0;">
        <div style="width: 64px; height: 64px; border-radius: 16px; background: linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(220, 38, 38, 0.1) 100%); border: 2px solid rgba(239, 68, 68, 0.3); display: flex; align-items: center; justify-content: center; margin: 0 auto 20px;">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2">
            <polyline points="3 6 5 6 21 6"></polyline>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
          </svg>
        </div>
        <h2 style="margin: 0 0 12px 0; font-size: 20px; font-weight: 600;">Delete Category?</h2>
        <p id="deleteCategoryMessage" style="margin: 0 0 20px 0; color: var(--muted); font-size: 14px; line-height: 1.6;">
          This will permanently delete this category.
        </p>
        <div id="deleteCategoryOptions" style="background: var(--panel); border: 1px solid var(--border); border-radius: 8px; padding: 16px; margin-bottom: 20px; text-align: left; display: none;">
          <div style="margin-bottom: 12px; font-size: 13px; font-weight: 600; color: var(--text);">What should happen to the passwords in this category?</div>
          <label style="display: flex; align-items: flex-start; gap: 10px; padding: 10px; border-radius: 6px; cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background='var(--bg)'" onmouseout="this.style.background='transparent'">
            <input type="radio" name="deleteCategoryAction" value="keep" checked style="margin-top: 2px;">
            <div>
              <div style="font-size: 14px; font-weight: 500; color: var(--text); margin-bottom: 4px;">Keep passwords</div>
              <div style="font-size: 12px; color: var(--muted);">Move <span id="deleteCategoryCount">0</span> password(s) to "Other" category</div>
            </div>
          </label>
          <label style="display: flex; align-items: flex-start; gap: 10px; padding: 10px; border-radius: 6px; cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background='var(--bg)'" onmouseout="this.style.background='transparent'">
            <input type="radio" name="deleteCategoryAction" value="delete" style="margin-top: 2px;">
            <div>
              <div style="font-size: 14px; font-weight: 500; color: var(--text); margin-bottom: 4px;">Delete passwords</div>
              <div style="font-size: 12px; color: var(--muted);">Permanently delete all passwords in this category</div>
            </div>
          </label>
        </div>
        <div id="deleteCategoryWarning" style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 8px; padding: 16px; margin-bottom: 20px; text-align: left; display: none;">
          <p style="margin: 0; font-size: 13px; color: #fca5a5;">
            <strong style="display: block; margin-bottom: 8px;">‚ö†Ô∏è Warning</strong>
            <span id="deleteCategoryWarningText"></span>
          </p>
        </div>
      </div>
      <div class="password-modal-footer" style="gap: 12px; justify-content: center;">
        <button class="btn btn-secondary" onclick="window.PasswordUI.closeDeleteCategoryModal()" style="min-width: 120px;">Cancel</button>
        <button class="btn btn-danger" onclick="window.PasswordUI.confirmDeleteCategory()" id="deleteCategoryConfirmBtn" style="min-width: 120px;">Delete</button>
      </div>
    </div>
  </div>
</section>

<!-- Documentation -->
<!-- System Configuration -->
<section id="view-system-configuration" class="view">
  <div class="view__header">
    <h1>üîß System Configuration</h1>
    <div style="flex:1"></div>
  </div>

  <!-- Configuration Tabs -->
  <div class="system-config-tabs">
    <button class="system-config-tab active" data-tab="coreservice">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83"/>
        <circle cx="12" cy="12" r="3"/>
      </svg>
      Core Service
    </button>
    <button class="system-config-tab" data-tab="emailserver">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
        <polyline points="22,6 12,13 2,6"/>
      </svg>
      Email Server
    </button>
    <button class="system-config-tab" data-tab="notifications">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
        <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
      </svg>
      Notifications
    </button>
    <button class="system-config-tab" data-tab="dbmaintenance">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
        <polyline points="12 2 12 12"/>
        <polyline points="12 12 7.5 9.5"/>
        <polyline points="12 12 16.5 9.5"/>
      </svg>
      DB Maintenance
    </button>
    <button class="system-config-tab" data-tab="updates">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
        <path d="M12 8v4l3 3"/>
        <polyline points="1 4 1 10 7 10"/>
        <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
      </svg>
      Updates
      <span class="nav-badge" id="updatesTabBadge" style="display:none; margin-left:auto; background:#f97316;">!</span>
    </button>
  </div>
  
  <!-- Core Service Tab Content -->
  <div id="systemConfigCoreService" class="system-config-content active">
    <div class="documentation-container">
      <!-- OrbisHub CoreService Section -->
    <div class="doc-section">
      <h2 class="doc-section-title">üîß OrbisHub CoreService</h2>
      
      <!-- CoreService Status Card -->
      <div class="doc-card">
        <div class="settings-row">
          <div class="settings-row-info">
            <h3>CoreService Connection</h3>
            <p>Connect to your OrbisHub CoreService API for agent management and job orchestration</p>
          </div>
          <div class="settings-row-control">
            <span class="status-badge" id="coreServiceStatusBadge">Not Configured</span>
          </div>
        </div>

        <div class="settings-row">
          <div class="settings-row-info">
            <h3>Server Address</h3>
            <p>IP address or hostname where CoreService is running (e.g., http://192.168.1.100:5000)</p>
          </div>
          <div class="settings-row-control" style="flex-direction: column; align-items: flex-end; gap: 8px;">
            <input 
              type="text" 
              class="input" 
              id="coreServiceAddress" 
              placeholder="http://localhost:5000"
              value=""
              style="width: 300px;"
            />
            <div style="display: flex; gap: 8px;">
              <button class="btn btn-ghost" id="testCoreServiceBtn">Test Connection</button>
              <button class="btn btn-primary" id="saveCoreServiceBtn">Save</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Installation Guide -->
      <div class="doc-card">
        <h3>üì¶ Installation Guide</h3>
        <p style="margin-bottom: 16px;">Follow these steps to install OrbisHub CoreService on your server.</p>
        
        <div class="doc-tip" style="margin-bottom: 20px;">
          <strong>üìç Pre-Built Location:</strong> If you have OrbisHub Desktop installed, the compiled CoreService is located at:<br>
          <code style="background: var(--bg-secondary); padding: 4px 8px; border-radius: 4px; margin-top: 8px; display: inline-block;">C:\Program Files\OrbisHub Desktop\resources\CoreService</code>
        </div>

        <!-- Step 1: Copy Files -->
        <details class="doc-faq-item" open>
          <summary><strong>Step 1: Copy CoreService Files to Server</strong></summary>
          <div style="padding: 12px 0;">
            <p>Copy the entire CoreService folder to your target server:</p>
            <pre class="doc-code" style="font-size: 12px;">
# On the source machine (where OrbisHub Desktop is installed)
Copy-Item "C:\Program Files\OrbisHub Desktop\resources\CoreService" `
  -Destination "\\\\ServerName\\C$\\OrbisHub\\CoreService" -Recurse

# Or copy to a local path on the server
Copy-Item "C:\Program Files\OrbisHub Desktop\resources\CoreService" `
  -Destination "C:\\OrbisHub\\CoreService" -Recurse</pre>
          </div>
        </details>

        <!-- Step 2: Configure -->
        <details class="doc-faq-item">
          <summary><strong>Step 2: Configure the Service</strong></summary>
          <div style="padding: 12px 0;">
            <p>Edit <code>appsettings.json</code> in the copied CoreService folder:</p>
            <pre class="doc-code" style="font-size: 12px;">
{
  "OrbisHub": {
    "ServiceName": "OrbisHub Core Service",
    "ServiceUrl": "http://YOUR_MACHINE_IP:5000",
    "ConnectionString": "Server=SQLSERVER\\INSTANCE;Database=OrbisHub;User id=USERNAME;password=PASSWORD;Integrated Security=true;TrustServerCertificate=True;",
    "HeartbeatTimeoutMinutes": 5,
    "JobTimeoutMinutes": 30
  }
}</pre>
            <p style="margin-top: 12px;"><strong>Important Settings:</strong></p>
            <ul style="margin-left: 20px; font-size: 13px;">
              <li><strong>ServiceUrl:</strong> Use <code>0.0.0.0</code> to listen on all network interfaces</li>
              <li><strong>ConnectionString:</strong> Your SQL Server connection details</li>
              <li><strong>HeartbeatTimeoutMinutes:</strong> How long before an agent is considered offline</li>
            </ul>
          </div>
        </details>

                <!-- Step 3: Install Service -->
        <details class="doc-faq-item">
          <summary><strong>Step 3: Install as Windows Service</strong></summary>
          <div style="padding: 12px 0;">
            <p>Open PowerShell or Command Prompt <strong>as Administrator</strong> on the server:</p>
            <pre class="doc-code" style="font-size: 12px;">
# Create the service (adjust path to match your installation location)
sc.exe create OrbisHubCoreService `
  binPath= "C:\OrbisHub\CoreService\OrbisHub.CoreService.exe" `
  start= auto

# Set service description
sc.exe description OrbisHubCoreService `
  "Central controller for OrbisHub agents and clients"

# Start the service
sc.exe start OrbisHubCoreService</pre>
            <div class="doc-warning" style="margin-top: 12px;">
              <strong>‚ö†Ô∏è Important:</strong> Ensure there is a space after <code>binPath=</code> and <code>start=</code> when using <code>sc.exe</code>.
            </div>
          </div>
        </details>

        <!-- Step 4: Verify -->
        <details class="doc-faq-item">
          <summary><strong>Step 4: Verify Installation</strong></summary>
          <div style="padding: 12px 0;">
            <p>Check service status:</p>
            <pre class="doc-code" style="font-size: 12px;">
Get-Service OrbisHubCoreService</pre>
            <p style="margin-top: 12px;">Test the API:</p>
            <pre class="doc-code" style="font-size: 12px;">
Invoke-RestMethod -Uri "http://localhost:5000/health"</pre>
            <p style="margin-top: 12px;">Expected response:</p>
            <pre class="doc-code" style="font-size: 12px;">
{
  "status": "healthy",
  "timestamp": "2025-11-29T10:30:00Z",
  "version": "1.0.0"
}</pre>
          </div>
        </details>

        <!-- Troubleshooting -->
        <details class="doc-faq-item">
          <summary><strong>üîç Troubleshooting</strong></summary>
          <div style="padding: 12px 0;">
            <ul style="margin-left: 20px; font-size: 13px;">
              <li><strong>Service won't start:</strong> Check Windows Event Viewer for errors</li>
              <li><strong>Port already in use:</strong> Change the port in <code>appsettings.json</code></li>
              <li><strong>Database connection fails:</strong> Verify SQL Server is running and connection string is correct</li>
              <li><strong>Access denied:</strong> Ensure the service runs with appropriate permissions</li>
            </ul>
          </div>
        </details>
      </div>

      <!-- API Documentation Link -->
      <div class="doc-card">
        <h3>üìö API Documentation</h3>
        <p>Once CoreService is running, you can access the Swagger API documentation at:</p>
        <code style="background: var(--bg-secondary); padding: 8px 12px; border-radius: 4px; display: inline-block; margin-top: 8px;">
          http://your-server:5000/swagger
        </code>
      </div>
    </div>
    </div>
  </div>

  <!-- Email Server Profile Tab Content -->
  <div id="systemConfigEmailServer" class="system-config-content">
    <div class="documentation-container">
      <div class="doc-section">
        <h2 class="doc-section-title">üìß Email Server Profile</h2>
        

        <!-- Email Profile Header Actions -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
          <div>
            <h3 style="margin: 0;">Email Server Profiles</h3>
            <p class="muted" style="margin: 4px 0 0 0; font-size: 13px;">
              Create and manage SMTP configurations for outbound emails
            </p>
          </div>
          <button class="btn btn-primary" id="createEmailProfileBtn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            Create Email Profile
          </button>
        </div>

        <!-- Email Profiles List (populated by JavaScript) -->
        <div id="emailProfilesList">
          <div class="empty-state">
            <div class="empty-icon">üìß</div>
            <h3>Loading email profiles...</h3>
          </div>
        </div>

        <!-- Email Configuration Tips -->
        <div class="doc-card" style="margin-top: 32px;">
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
            <div style="width: 40px; height: 40px; border-radius: 10px; background: linear-gradient(135deg, var(--primary) 0%, color-mix(in oklab, var(--primary) 80%, #000) 100%); display: flex; align-items: center; justify-content: center;">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="16" x2="12" y2="12"/>
                <line x1="12" y1="8" x2="12.01" y2="8"/>
              </svg>
            </div>
            <div>
              <h3 style="margin: 0; font-size: 16px; font-weight: 600; color: var(--text);">Common SMTP Provider Settings</h3>
              <p style="margin: 4px 0 0 0; font-size: 13px; color: var(--muted);">Quick reference for popular email providers</p>
            </div>
          </div>
          <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
            <thead>
              <tr style="background: color-mix(in oklab, var(--bg) 50%, var(--panel)); border-bottom: 2px solid var(--border);">
                <th style="padding: 12px; text-align: left; font-weight: 600; color: var(--text);">Provider</th>
                <th style="padding: 12px; text-align: left; font-weight: 600; color: var(--text);">SMTP Host</th>
                <th style="padding: 12px; text-align: left; font-weight: 600; color: var(--text);">Port</th>
                <th style="padding: 12px; text-align: left; font-weight: 600; color: var(--text);">Security</th>
              </tr>
            </thead>
            <tbody>
              <tr style="border-bottom: 1px solid var(--border);">
                <td style="padding: 12px; color: var(--text);"><strong>Gmail</strong></td>
                <td style="padding: 12px; font-family: monospace; color: var(--primary);">smtp.gmail.com</td>
                <td style="padding: 12px; color: var(--text);">587 (TLS) or 465 (SSL)</td>
                <td style="padding: 12px; color: var(--text);">TLS/SSL</td>
              </tr>
              <tr style="border-bottom: 1px solid var(--border);">
                <td style="padding: 12px; color: var(--text);"><strong>Outlook / Office 365</strong></td>
                <td style="padding: 12px; font-family: monospace; color: var(--primary);">smtp.office365.com</td>
                <td style="padding: 12px; color: var(--text);">587</td>
                <td style="padding: 12px; color: var(--text);">TLS</td>
              </tr>
              <tr style="border-bottom: 1px solid var(--border);">
                <td style="padding: 12px; color: var(--text);"><strong>Yahoo Mail</strong></td>
                <td style="padding: 12px; font-family: monospace; color: var(--primary);">smtp.mail.yahoo.com</td>
                <td style="padding: 12px; color: var(--text);">587 or 465</td>
                <td style="padding: 12px; color: var(--text);">TLS/SSL</td>
              </tr>
              <tr style="border-bottom: 1px solid var(--border);">
                <td style="padding: 12px; color: var(--text);"><strong>SendGrid</strong></td>
                <td style="padding: 12px; font-family: monospace; color: var(--primary);">smtp.sendgrid.net</td>
                <td style="padding: 12px; color: var(--text);">587</td>
                <td style="padding: 12px; color: var(--text);">TLS</td>
              </tr>
              <tr>
                <td style="padding: 12px; color: var(--text);"><strong>Custom / Exchange</strong></td>
                <td style="padding: 12px; font-family: monospace; color: var(--primary);">mail.yourdomain.com</td>
                <td style="padding: 12px; color: var(--text);">25, 587, or 465</td>
                <td style="padding: 12px; color: var(--text);">Varies</td>
              </tr>
            </tbody>
          </table>

          <div style="margin-top: 20px; padding: 16px; background: color-mix(in oklab, var(--primary) 8%, transparent); border-left: 4px solid var(--primary); border-radius: 8px;">
            <div style="display: flex; gap: 12px;">
              <div style="flex-shrink: 0;">üí°</div>
              <div>
                <strong style="color: var(--text); font-size: 13px;">Gmail Users:</strong>
                <p style="margin: 6px 0 0 0; font-size: 13px; color: var(--muted); line-height: 1.5;">
                  You'll need to create an App Password instead of using your regular password. 
                  Go to your Google Account ‚Üí Security ‚Üí 2-Step Verification ‚Üí App passwords.
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- Features Overview -->
        <div class="doc-card" style="margin-top: 20px;">
          <h3>‚ú® Email Features</h3>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 16px;">
            <div>
              <h4 style="font-size: 14px; margin: 0 0 8px 0; color: #2563eb;">üîê Password Recovery</h4>
              <p style="margin: 0; font-size: 13px; color: #6b7280;">
                Send password reset links to users who forgot their credentials
              </p>
            </div>
            <div>
              <h4 style="font-size: 14px; margin: 0 0 8px 0; color: #2563eb;">üêõ Bug Reports</h4>
              <p style="margin: 0; font-size: 13px; color: #6b7280;">
                Automatically notify admins when users report bugs in the system
              </p>
            </div>
            <div>
              <h4 style="font-size: 14px; margin: 0 0 8px 0; color: #2563eb;">üîî Notifications</h4>
              <p style="margin: 0; font-size: 13px; color: #6b7280;">
                Send account lockout alerts and security notifications
              </p>
            </div>
            <div>
              <h4 style="font-size: 14px; margin: 0 0 8px 0; color: #2563eb;">üìß Custom Emails</h4>
              <p style="margin: 0; font-size: 13px; color: #6b7280;">
                Use templates to send custom emails for any purpose
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Notifications Tab Content -->
  <div id="systemConfigNotifications" class="system-config-content">
    <div class="documentation-container">
      <div class="stack">
      <div class="card">
        <h3>System Alerts</h3>
        <p class="muted" style="margin-bottom:20px;">Configure notifications for system events, errors, and critical alerts.</p>
        
        <div style="display:flex; align-items:center; margin-bottom:24px;">
          <label style="flex:1; font-weight:500;">Enable System Alerts</label>
          <label class="toggle-switch">
            <input type="checkbox" id="notifySystemEnabled">
            <span class="toggle-slider"></span>
          </label>
        </div>
        
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-bottom:16px;">
          <div>
            <label class="label" style="display:block; margin-bottom:8px;">Alert Level</label>
            <select id="notifySystemLevel" class="input" style="width:100%;">
              <option value="all">All Alerts</option>
              <option value="warning">Warnings & Errors</option>
              <option value="error">Errors Only</option>
            </select>
          </div>
          
          <div>
            <label class="label" style="display:block; margin-bottom:8px;">Email Server Profile</label>
            <select id="notifySystemProfile" class="input" style="width:100%;">
              <option value="">Select Email Profile...</option>
            </select>
          </div>
        </div>
        
        <div>
          <label class="label" style="display:block; margin-bottom:8px;">Recipients</label>
          <input type="text" id="notifySystemRecipients" class="input" placeholder="email@example.com, user@domain.com" style="width:100%;">
          <span style="font-size:11px; color:var(--muted); margin-top:4px; display:block;">Comma-separated email addresses or usernames</span>
        </div>
      </div>
      
      <div class="card">
        <h3>Daily Summary Reports</h3>
        <p class="muted" style="margin-bottom:20px;">Receive daily summary of all activities and system status.</p>
        
        <div style="display:flex; align-items:center; margin-bottom:24px;">
          <label style="flex:1; font-weight:500;">Enable Daily Summary</label>
          <label class="toggle-switch">
            <input type="checkbox" id="notifySummaryEnabled">
            <span class="toggle-slider"></span>
          </label>
        </div>
        
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-bottom:16px;">
          <div>
            <label class="label" style="display:block; margin-bottom:8px;">Delivery Time</label>
            <input type="time" id="notifySummaryTime" class="input" value="09:00" style="width:100%;">
          </div>
          
          <div>
            <label class="label" style="display:block; margin-bottom:8px;">Email Server Profile</label>
            <select id="notifySummaryProfile" class="input" style="width:100%;">
              <option value="">Select Email Profile...</option>
            </select>
          </div>
        </div>
        
        <div>
          <label class="label" style="display:block; margin-bottom:8px;">Recipients</label>
          <input type="text" id="notifySummaryRecipients" class="input" placeholder="email@example.com, user@domain.com" style="width:100%;">
          <span style="font-size:11px; color:var(--muted); margin-top:4px; display:block;">Comma-separated email addresses or usernames</span>
        </div>
      </div>
      
      <div class="card">
        <h3>Environment Health Monitoring</h3>
        <p class="muted" style="margin-bottom:20px;">Get notified when environment health status changes.</p>
        
        <div style="display:flex; align-items:center; margin-bottom:24px;">
          <label style="flex:1; font-weight:500;">Enable Health Monitoring</label>
          <label class="toggle-switch">
            <input type="checkbox" id="notifyHealthEnabled">
            <span class="toggle-slider"></span>
          </label>
        </div>
        
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-bottom:16px;">
          <div>
            <label class="label" style="display:block; margin-bottom:8px;">Notify When Status Changes To</label>
            <select id="notifyHealthStatus" class="input" style="width:100%;">
              <option value="all">Any Status Change</option>
              <option value="unhealthy">Unhealthy Only</option>
              <option value="critical">Critical Only</option>
            </select>
          </div>
          
          <div>
            <label class="label" style="display:block; margin-bottom:8px;">Email Server Profile</label>
            <select id="notifyHealthProfile" class="input" style="width:100%;">
              <option value="">Select Email Profile...</option>
            </select>
          </div>
        </div>
        
        <div>
          <label class="label" style="display:block; margin-bottom:8px;">Recipients</label>
          <input type="text" id="notifyHealthRecipients" class="input" placeholder="email@example.com, user@domain.com" style="width:100%;">
          <span style="font-size:11px; color:var(--muted); margin-top:4px; display:block;">Comma-separated email addresses or usernames</span>
        </div>
      </div>
      
      <div style="display:flex; gap:12px; margin-top:20px;">
        <button id="saveNotificationsBtn" class="btn" style="background:linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color:white; border:none;">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:8px;">
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
          Save Notification Settings
        </button>
        <button id="testNotificationBtn" class="btn btn-ghost">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:8px;">
            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
          </svg>
          Send Test Notification
        </button>
      </div>
    </div>
    </div>
  </div>

  <!-- DB Maintenance Tab Content -->
  <div id="systemConfigDbMaintenance" class="system-config-content">
    <div class="documentation-container">
      <div class="stack">
        
        <!-- Database Statistics Section -->
        <div class="maintenance-section">
          <h3>üìä Database Statistics</h3>
          <p class="muted">View comprehensive statistics about your database size, tables, and records.</p>
          
          <div style="display: flex; justify-content: flex-end; margin-bottom: 16px;">
            <button id="refreshDbStatsBtn" class="btn btn-ghost">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="23 4 23 10 17 10"></polyline>
                <polyline points="1 20 1 14 7 14"></polyline>
                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
              </svg>
              Refresh
            </button>
          </div>
          
          <div id="dbStatsContainer">
            <div style="text-align: center; padding: 40px;">
              <div class="spinner-ring" style="margin: 0 auto;"></div>
              <p class="muted" style="margin-top: 12px;">Loading database statistics...</p>
            </div>
          </div>
        </div>

        <!-- Database Optimization Section -->
        <div class="maintenance-section">
          <h3>‚ö° Database Optimization</h3>
          <p class="muted">Optimize database performance by rebuilding indexes and updating statistics.</p>
          
          <div class="maintenance-actions">
            <div class="maintenance-action">
              <h4>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
                </svg>
                Rebuild Indexes
              </h4>
              <p>Rebuild all database indexes to improve query performance and reduce fragmentation.</p>
              <button id="rebuildIndexesBtn" class="btn" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white; border: none;" data-permissions-any="databases:execute,*:*">
                Rebuild All Indexes
              </button>
            </div>

            <div class="maintenance-action">
              <h4>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 3v18h18"/>
                  <path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"/>
                </svg>
                Update Statistics
              </h4>
              <p>Update database statistics to help the query optimizer make better decisions.</p>
              <button id="updateStatisticsBtn" class="btn" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none;" data-permissions-any="databases:execute,*:*">
                Update Statistics
              </button>
            </div>

            <div class="maintenance-action">
              <h4>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                </svg>
                Shrink Database
              </h4>
              <p>Reclaim unused space in the database. Use sparingly as it can cause fragmentation.</p>
              <button id="shrinkDatabaseBtn" class="btn btn-ghost" data-permissions-any="databases:execute,*:*">
                Shrink Database
              </button>
            </div>
          </div>
        </div>

        <!-- Database Backup Section -->
        <div class="maintenance-section">
          <h3>üíæ Database Backup</h3>
          <p class="muted">Create a full backup of your database to protect against data loss.</p>
          
          <div class="warning-box">
            <div class="warning-icon">‚ö†Ô∏è</div>
            <div class="warning-content">
              <h4>Important: Regular Backups</h4>
              <p>Always maintain regular database backups. Schedule automated backups through SQL Server Management Studio or SQL Server Agent for production environments.</p>
            </div>
          </div>

          <div class="input-group">
            <input 
              type="text" 
              id="backupPathInput" 
              class="input" 
              placeholder="C:\Temp\OrbisHub_Backup.bak"
              style="flex: 1;"
            />
            <button id="backupDatabaseBtn" class="btn" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; border: none;" data-permissions-any="databases:execute,*:*">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px;">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7 10 12 15 17 10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
              </svg>
              Create Backup
            </button>
          </div>
          <span style="font-size: 11px; color: var(--muted); margin-top: 8px; display: block;">
            Specify the full path on the SQL Server machine (e.g., C:\Temp\OrbisHub.bak). The directory must exist and the SQL Server service account must have write permissions.
          </span>
        </div>

        <!-- Data Cleanup Section -->
        <div class="maintenance-section">
          <h3>üßπ Data Cleanup</h3>
          <p class="muted">Remove old and orphaned data to keep your database clean and efficient.</p>
          
          <div class="maintenance-actions">
            <div class="maintenance-action">
              <h4>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                </svg>
                Cleanup Audit Logs
              </h4>
              <p>Remove audit log entries older than the specified retention period.</p>
              <div class="input-group" style="margin-bottom: 8px;">
                <input 
                  type="number" 
                  id="auditRetentionDays" 
                  class="input" 
                  value="90" 
                  min="1"
                  style="width: 100px;"
                />
                <span style="color: var(--muted); font-size: 13px;">days</span>
              </div>
              <button id="cleanupAuditBtn" class="btn" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; border: none;" data-permissions-any="databases:execute,*:*">
                Cleanup Old Logs
              </button>
            </div>

            <div class="maintenance-action">
              <h4>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="3 6 5 6 21 6"/>
                  <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                </svg>
                Remove Orphaned Records
              </h4>
              <p>Identify and remove records that reference non-existent parent records.</p>
              <button id="cleanupOrphansBtn" class="btn" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; border: none;" data-permissions-any="databases:execute,*:*">
                Cleanup Orphaned Data
              </button>
            </div>
          </div>
        </div>

        <!-- Database Health Check Section -->
        <div class="maintenance-section">
          <h3>üè• Database Health Check</h3>
          <p class="muted">Run comprehensive health checks to identify potential issues and get recommendations.</p>
          
          <div class="info-box">
            <div class="info-icon">‚ÑπÔ∏è</div>
            <div class="info-content">
              <h4>Health Check Overview</h4>
              <p>This tool performs various checks including database integrity, index fragmentation, space usage, missing indexes, and backup status. Use this regularly to maintain optimal database health.</p>
            </div>
          </div>

          <button id="checkDbHealthBtn" class="btn" style="background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); color: white; border: none; width: 100%;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px;">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
              <polyline points="22 4 12 14.01 9 11.01"/>
            </svg>
            Run Health Check
          </button>

          <div id="healthCheckResults" style="margin-top: 24px;">
            <!-- Health check results will be displayed here -->
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- Updates Tab Content -->
  <div id="systemConfigUpdates" class="system-config-content">
    <div class="documentation-container">
      <div class="stack">
        
        <!-- Update Status Section -->
        <div class="maintenance-section">
          <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px;">
            <div style="width: 64px; height: 64px; border-radius: 16px; background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
              <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                <path d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                <path d="M12 8v4l3 3"/>
                <polyline points="1 4 1 10 7 10"/>
                <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
              </svg>
            </div>
            <div style="flex: 1;">
              <h2 style="margin: 0;">Application Updates</h2>
              <p class="muted" style="margin: 4px 0 0 0; font-size: 13px;">
                Keep OrbisHub Desktop up to date with the latest features and improvements
              </p>
            </div>
          </div>

          <!-- Current Version & Update Status -->
          <div class="doc-card" style="background: var(--bg-secondary); border: 2px solid var(--border);">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
              <div>
                <h3 style="margin: 0 0 8px 0;">Current Version</h3>
                <div style="display: flex; align-items: center; gap: 12px;">
                  <span id="currentVersionNumber" style="font-size: 32px; font-weight: 700; color: var(--primary);">v1.5.3</span>
                  <span id="updateStatusLabel" class="status-badge" style="font-size: 12px;">Checking...</span>
                </div>
              </div>
              <div>
                <button id="checkUpdateBtn" class="btn btn-primary">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px;">
                    <polyline points="23 4 23 10 17 10"/>
                    <polyline points="1 20 1 14 7 14"/>
                    <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                  </svg>
                  Check for Updates
                </button>
              </div>
            </div>

            <!-- Update Available Section (Hidden by default) -->
            <div id="updateAvailableSection" style="display: none; padding: 20px; background: color-mix(in srgb, #f97316 10%, var(--panel)); border: 2px solid #f97316; border-radius: 12px; margin-top: 16px;">
              <div style="display: flex; align-items: start; gap: 16px;">
                <div style="width: 48px; height: 48px; border-radius: 12px; background: #f97316; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                    <path d="M12 8v4"/>
                    <path d="M12 16h.01"/>
                  </svg>
                </div>
                <div style="flex: 1;">
                  <h3 style="margin: 0 0 8px 0; color: #f97316;">Update Available!</h3>
                  <p id="updateAvailableText" style="margin: 0 0 16px 0; font-size: 14px;">
                    Version <span id="availableVersion">1.6.0</span> is ready to download
                  </p>
                  
                  <!-- Download Progress -->
                  <div id="downloadProgressSection" style="display: none; margin-bottom: 16px;">
                    <div class="update-progress">
                      <div id="downloadProgressFill" class="update-progress__fill"></div>
                      <span id="downloadProgressText" class="update-progress__text">0%</span>
                    </div>
                    <p id="downloadProgressInfo" class="muted" style="font-size: 12px; margin-top: 8px;">Downloading...</p>
                  </div>

                  <div style="display: flex; gap: 12px;">
                    <button id="downloadUpdateBtn" class="btn" style="background: #f97316; color: white; border: none;">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px;">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                      </svg>
                      Download Update
                    </button>
                    <button id="installUpdateBtn" class="btn" style="background: #10b981; color: white; border: none; display: none;">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px;">
                        <polyline points="23 4 23 10 17 10"/>
                        <polyline points="1 20 1 14 7 14"/>
                        <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                      </svg>
                      Install & Restart
                    </button>
                    <button id="dismissUpdateBtn" class="btn btn-ghost">Later</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Changelog Section -->
        <div class="maintenance-section">
          <h3>üìã Version History & Changelog</h3>
          <p class="muted" style="margin-bottom: 20px;">Review changes and improvements across different versions</p>
          
          <div id="changelogContainer" class="changelog-container">
            <!-- Version 1.5.3 -->
            <div class="changelog-version">
              <div class="changelog-version-header">
                <div style="display: flex; align-items: center; gap: 12px;">
                  <span class="changelog-version-number">v1.5.3</span>
                  <span class="changelog-version-badge current">Current</span>
                </div>
                <span class="changelog-version-date">December 9, 2025</span>
              </div>
              <div class="changelog-version-content">
                <div class="changelog-section">
                  <h4>üéâ New Features</h4>
                  <ul>
                    <li>Added comprehensive update management system</li>
                    <li>Introduced Updates tab in System Configuration</li>
                    <li>Real-time update notifications with orange badges</li>
                    <li>Detailed changelog display between versions</li>
                  </ul>
                </div>
                <div class="changelog-section">
                  <h4>üêõ Bug Fixes</h4>
                  <ul>
                    <li>Fixed database connection stability issues</li>
                    <li>Improved error handling in CoreService integration</li>
                  </ul>
                </div>
              </div>
            </div>

            <!-- Version 1.5.2 -->
            <div class="changelog-version">
              <div class="changelog-version-header">
                <div style="display: flex; align-items: center; gap: 12px;">
                  <span class="changelog-version-number">v1.5.2</span>
                </div>
                <span class="changelog-version-date">November 28, 2025</span>
              </div>
              <div class="changelog-version-content">
                <div class="changelog-section">
                  <h4>‚ú® Improvements</h4>
                  <ul>
                    <li>Enhanced database maintenance tools</li>
                    <li>Optimized query performance</li>
                    <li>Updated UI components for better accessibility</li>
                  </ul>
                </div>
                <div class="changelog-section">
                  <h4>üîß Technical</h4>
                  <ul>
                    <li>Upgraded Electron to latest stable version</li>
                    <li>Improved security with updated dependencies</li>
                  </ul>
                </div>
              </div>
            </div>

            <!-- Version 1.5.1 -->
            <div class="changelog-version">
              <div class="changelog-version-header">
                <div style="display: flex; align-items: center; gap: 12px;">
                  <span class="changelog-version-number">v1.5.1</span>
                </div>
                <span class="changelog-version-date">November 15, 2025</span>
              </div>
              <div class="changelog-version-content">
                <div class="changelog-section">
                  <h4>üéâ New Features</h4>
                  <ul>
                    <li>Added Email Server Profile management</li>
                    <li>Implemented notification system</li>
                    <li>Enhanced user permission controls</li>
                  </ul>
                </div>
                <div class="changelog-section">
                  <h4>üêõ Bug Fixes</h4>
                  <ul>
                    <li>Resolved login session timeout issues</li>
                    <li>Fixed agent heartbeat monitoring</li>
                    <li>Corrected environment deployment status</li>
                  </ul>
                </div>
              </div>
            </div>

            <!-- Version 1.5.0 -->
            <div class="changelog-version">
              <div class="changelog-version-header">
                <div style="display: flex; align-items: center; gap: 12px;">
                  <span class="changelog-version-number">v1.5.0</span>
                </div>
                <span class="changelog-version-date">October 30, 2025</span>
              </div>
              <div class="changelog-version-content">
                <div class="changelog-section">
                  <h4>üéâ New Features</h4>
                  <ul>
                    <li>Introduced OrbisHub CoreService integration</li>
                    <li>Added Orbis Agent management interface</li>
                    <li>Implemented ticket management system</li>
                    <li>Added password manager functionality</li>
                    <li>New bug reporting module</li>
                  </ul>
                </div>
                <div class="changelog-section">
                  <h4>‚ú® Improvements</h4>
                  <ul>
                    <li>Complete UI redesign with modern interface</li>
                    <li>Enhanced security with improved authentication</li>
                    <li>Better error messages and user feedback</li>
                  </ul>
                </div>
              </div>
            </div>

          </div>
        </div>

        <!-- Release Notes Section -->
        <div class="maintenance-section">
          <h3>üìù Release Information</h3>
          <div class="doc-card" style="background: var(--bg-secondary); border: 1px solid var(--border);">
            <div style="display: flex; align-items: start; gap: 16px;">
              <div style="width: 48px; height: 48px; border-radius: 12px; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <line x1="12" y1="16" x2="12" y2="12"/>
                  <line x1="12" y1="8" x2="12.01" y2="8"/>
                </svg>
              </div>
              <div style="flex: 1;">
                <h4 style="margin: 0 0 12px 0; font-size: 16px; font-weight: 600;">Automatic Updates</h4>
                <p style="margin: 0 0 12px 0; color: var(--muted); font-size: 14px; line-height: 1.6;">OrbisHub Desktop automatically checks for updates on startup. When a new version is available, you'll see an orange notification badge on the System Configuration menu and Updates tab.</p>
                <p style="margin: 12px 0 8px 0; font-weight: 600; font-size: 14px;">Update Process:</p>
                <ol style="margin: 0; padding-left: 20px; color: var(--muted); font-size: 13px; line-height: 1.8;">
                  <li>Click "Download Update" when available</li>
                  <li>Wait for the download to complete</li>
                  <li>Click "Install & Restart" to apply the update</li>
                  <li>Application will restart automatically with the new version</li>
                </ol>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</section>

<section id="view-admin-documentation" class="view">
  <div class="view__header">
    <h1>üìö OrbisHub Documentation</h1>
    <div style="flex:1"></div>
    <!-- <button class="btn btn-ghost" onclick="showView('admin')">‚Üê Back to Admin</button> -->
  </div>
  
  <div class="documentation-container">
    <!-- Hero Section -->
    <div class="doc-hero">
      <h1>OrbisHub</h1>
      <p class="doc-hero-tagline">By Admins, For Admins</p>
      <p class="doc-hero-description">A comprehensive system administration and DevOps dashboard for managing environments, servers, remote connections, and notifications‚Äîall from one centralized interface.</p>
    </div>

    <!-- Quick Start -->
    <div class="doc-section">
      <h2 class="doc-section-title">üöÄ Quick Start</h2>
      <div class="doc-card">
        <h3>Getting Started in 5 Steps</h3>
        <ol class="doc-list">
          <li><strong>View Summary Dashboard:</strong> Start at the Summary page to see an overview of your entire system‚Äîenvironments, servers, and recent activity.</li>
          <li><strong>Add Credentials:</strong> Navigate to Credentials in System Administrators to securely store login credentials for your servers.</li>
          <li><strong>Register Servers:</strong> Go to Remote Desktop Manager and add your infrastructure with IP addresses and assigned credentials for one-click RDP access.</li>
          <li><strong>Create Farm Systems:</strong> Define your deployment targets (Production, Staging, Dev) to organize your infrastructure logically.</li>
        </ol>
        <div class="doc-tip">
          <strong>üí° Pro Tip:</strong> Press <kbd>Ctrl+`</kbd> to open the Command Palette for quick navigation!
        </div>
      </div>
    </div>

    <!-- Core Features -->
    <div class="doc-section">
      <h2 class="doc-section-title">‚ú® Core Features</h2>
      
      <div class="doc-feature-grid">
        <div class="doc-feature-card">
          <div class="doc-feature-icon">üìä</div>
          <h3>Summary Dashboard</h3>
          <p>Complete overview of your system at a glance</p>
          <ul class="doc-feature-list">
            <li>Real-time statistics for all modules</li>
            <li>Environment and server health status</li>
            <li>Recent activity feed with timeline</li>
            <li>Quick action buttons for common tasks</li>
            <li>System health indicators</li>
            <li>User activity tracking</li>
          </ul>
        </div>

        <div class="doc-feature-card">
          <div class="doc-feature-icon">üë•</div>
          <h3>Users & Permissions</h3>
          <p>Team access control and role management</p>
          <ul class="doc-feature-list">
            <li>Role-based access control (Admin, User, Viewer)</li>
            <li>Online/offline status indicators</li>
            <li>User activity and session tracking</li>
            <li>Position and squad organization</li>
            <li>Password change enforcement</li>
            <li>Account lockout after failed attempts</li>
            <li>Session timeout after inactivity</li>
          </ul>
        </div>

        <div class="doc-feature-card">
          <div class="doc-feature-icon">üåç</div>
          <h3>Environments</h3>
          <p>Organize infrastructure by deployment targets</p>
          <ul class="doc-feature-list">
            <li>Multiple environments (Prod, Staging, Dev, Test)</li>
            <li>Health status monitoring with indicators</li>
            <li>Environment-specific configurations</li>
            <li>Card locking to prevent accidental changes</li>
            <li>Deployment tracking and history</li>
            <li>URL management for quick access</li>
            <li>Server mapping and association</li>
          </ul>
        </div>

        <div class="doc-feature-card">
          <div class="doc-feature-icon">üñ•Ô∏è</div>
          <h3>Remote Desktop Manager</h3>
          <p>One-click remote server connections</p>
          <ul class="doc-feature-list">
            <li>Native RDP connections via mstsc.exe</li>
            <li>SSH/PuTTY integration for Linux servers</li>
            <li>Server inventory with IP addresses</li>
            <li>Server grouping (Production, Stage, Test, Dev)</li>
            <li>Health monitoring and status tracking</li>
            <li>Connection history and tracking</li>
            <li>Card locking for production servers</li>
          </ul>
        </div>

        <div class="doc-feature-card">
          <div class="doc-feature-icon">üîê</div>
          <h3>Credentials</h3>
          <p>Secure credential storage and management</p>
          <ul class="doc-feature-list">
            <li>AES-256 encrypted credential storage</li>
            <li>Username, password, and domain support</li>
            <li>Credential assignment to servers</li>
            <li>Deployment credential integration</li>
            <li>Credential auditing and tracking</li>
            <li>Protection against deletion when in use</li>
            <li>External system credential mapping</li>
          </ul>
        </div>

        <div class="doc-feature-card">
          <div class="doc-feature-icon">üí¨</div>
          <h3>Team Messaging</h3>
          <p>Secure peer-to-peer communication</p>
          <ul class="doc-feature-list">
            <li>Direct messaging between users</li>
            <li>AES-256-CBC message encryption</li>
            <li>File attachments with secure storage</li>
            <li>Unread notifications</li>
            <li>Read receipts</li>
            <li>Real-time desktop notifications</li>
            <li>Persistent conversation history</li>
          </ul>
        </div>

        <div class="doc-feature-card">
          <div class="doc-feature-icon">üìã</div>
          <h3>Audit Logs</h3>
          <p>Complete activity tracking and compliance</p>
          <ul class="doc-feature-list">
            <li>Track all user actions (create, update, delete, connect)</li>
            <li>Timestamp and user attribution</li>
            <li>IP address logging for all actions</li>
            <li>Filter by action type, entity, user, or keyword</li>
            <li>Export logs for compliance reporting</li>
            <li>RDP connection tracking</li>
            <li>Old vs new value comparison</li>
          </ul>
        </div>

        <div class="doc-feature-card">
          <div class="doc-feature-icon">ü§ñ</div>
          <h3>Orbis Agents</h3>
          <p>Remote machine monitoring and script execution</p>
          <ul class="doc-feature-list">
            <li>PowerShell agent for Windows machines</li>
            <li>Automatic agent registration and heartbeat</li>
            <li>Remote script execution (PowerShell/CMD)</li>
            <li>System metrics collection (CPU, Memory, Disk)</li>
            <li>Job queue management</li>
            <li>Real-time agent status monitoring</li>
            <li>One-click agent deployment</li>
          </ul>
        </div>

        <div class="doc-feature-card">
          <div class="doc-feature-icon">üîß</div>
          <h3>Core Service</h3>
          <p>Central controller for OrbisHub ecosystem</p>
          <ul class="doc-feature-list">
            <li>ASP.NET Core REST API</li>
            <li>Windows Service with auto-start</li>
            <li>Agent registration and heartbeat monitoring</li>
            <li>Job queue management (FIFO)</li>
            <li>Background timeout handling services</li>
            <li>Windows Event Log logging</li>
            <li>Swagger API documentation</li>
          </ul>
        </div>

        <div class="doc-feature-card">
          <div class="doc-feature-icon">üóÑÔ∏è</div>
          <h3>Database Management</h3>
          <p>SQL Server integration and schema management</p>
          <ul class="doc-feature-list">
            <li>SQL Server connection configuration</li>
            <li>Windows and SQL Authentication support</li>
            <li>Schema initialization and migration</li>
            <li>Automated table creation</li>
            <li>Connection pooling</li>
            <li>Trust certificate for self-signed certs</li>
            <li>Database setup wizard</li>
          </ul>
        </div>

        <div class="doc-feature-card">
          <div class="doc-feature-icon">üîî</div>
          <h3>Notifications</h3>
          <p>Automated alerts and daily summaries</p>
          <ul class="doc-feature-list">
            <li>System alerts for errors and warnings</li>
            <li>Daily summary reports with scheduling</li>
            <li>Environment health change alerts</li>
            <li>Email notification support</li>
            <li>Test notification functionality</li>
            <li>Desktop toast notifications</li>
          </ul>
        </div>

        <div class="doc-feature-card">
          <div class="doc-feature-icon">üîó</div>
          <h3>External Integrations</h3>
          <p>Connect to external systems and services</p>
          <ul class="doc-feature-list">
            <li>Exchange Server integration</li>
            <li>SharePoint connectivity</li>
            <li>Connection string management</li>
            <li>Integration testing</li>
            <li>Credential mapping</li>
            <li>Custom metadata storage</li>
          </ul>
        </div>

        <div class="doc-feature-card">
          <div class="doc-feature-icon">üìà</div>
          <h3>Monitoring & Diagnostics</h3>
          <p>Server health checks and uptime tracking</p>
          <ul class="doc-feature-list">
            <li>ICMP ping and TCP port probing</li>
            <li>Multi-port fallback mechanism</li>
            <li>WMI/CIM queries for Windows uptime</li>
            <li>/proc/uptime parsing for Linux</li>
            <li>Real-time connectivity testing</li>
            <li>Network diagnostics</li>
            <li>Health status indicators</li>
          </ul>
        </div>

        <div class="doc-feature-card">
          <div class="doc-feature-icon">üîÑ</div>
          <h3>Auto-Update System</h3>
          <p>Automatic update detection and installation</p>
          <ul class="doc-feature-list">
            <li>GitHub Releases integration</li>
            <li>Background update downloads</li>
            <li>Version management</li>
            <li>Update notifications</li>
            <li>User-controlled update process</li>
            <li>Rollback support</li>
          </ul>
        </div>

        <div class="doc-feature-card">
          <div class="doc-feature-icon">üîç</div>
          <h3>ElasticSearch</h3>
          <p>Log analysis and search capabilities</p>
          <ul class="doc-feature-list">
            <li>Integration with ElasticSearch clusters</li>
            <li>Log aggregation and search</li>
            <li>Real-time log monitoring</li>
            <li>Analytics and visualization</li>
          </ul>
        </div>

        <div class="doc-feature-card">
          <div class="doc-feature-icon">üõ°Ô∏è</div>
          <h3>Security Features</h3>
          <p>Enterprise-grade security controls</p>
          <ul class="doc-feature-list">
            <li>PBKDF2 password hashing with salt</li>
            <li>Strong password policies</li>
            <li>Account lockout protection (5 failed attempts)</li>
            <li>Session management (10-min timeout)</li>
            <li>Force password change on first login</li>
            <li>Activity tracking with IP logging</li>
            <li>Role-based access control</li>
          </ul>
        </div>

        <div class="doc-feature-card">
          <div class="doc-feature-icon">üé´</div>
          <h3>Ticket Management</h3>
          <p>Complete issue tracking and project management</p>
          <ul class="doc-feature-list">
            <li>Create and manage tickets with rich metadata</li>
            <li>Project, status, priority, and type organization</li>
            <li>Assignee management and tracking</li>
            <li>Comments and activity logging</li>
            <li>Story points and time estimation</li>
            <li>Due dates with overdue indicators</li>
            <li>Advanced filtering and search</li>
            <li>Real-time statistics dashboard</li>
          </ul>
        </div>

        <div class="doc-feature-card">
          <div class="doc-feature-icon">üîë</div>
          <h3>Password Manager</h3>
          <p>Secure password vault and generation</p>
          <ul class="doc-feature-list">
            <li>AES-256 encrypted password storage</li>
            <li>Password strength analyzer</li>
            <li>Secure password generator</li>
            <li>Category organization (Personal, Work, Finance, etc.)</li>
            <li>Favorite and search functionality</li>
            <li>Copy to clipboard with auto-clear</li>
            <li>Password history tracking</li>
            <li>Secure notes and metadata</li>
          </ul>
        </div>

        <div class="doc-feature-card">
          <div class="doc-feature-icon">üêõ</div>
          <h3>Bug Reporting</h3>
          <p>Streamlined bug reporting workflow</p>
          <ul class="doc-feature-list">
            <li>Severity level classification (Critical to Minor)</li>
            <li>Category-based organization</li>
            <li>Step-by-step reproduction tracking</li>
            <li>Expected vs actual behavior documentation</li>
            <li>Email integration for submissions</li>
            <li>Form validation and character limits</li>
            <li>User-friendly submission process</li>
          </ul>
        </div>

        <div class="doc-feature-card">
          <div class="doc-feature-icon">üìß</div>
          <h3>Email Server Profiles</h3>
          <p>Centralized email server configuration</p>
          <ul class="doc-feature-list">
            <li>SMTP server profile management</li>
            <li>Exchange Server integration</li>
            <li>SSL/TLS encryption support</li>
            <li>Authentication configuration</li>
            <li>Test email functionality</li>
            <li>Multiple profile support</li>
            <li>Default profile selection</li>
          </ul>
        </div>

        <div class="doc-feature-card">
          <div class="doc-feature-icon">üîì</div>
          <h3>User Recovery</h3>
          <p>Password reset and account recovery</p>
          <ul class="doc-feature-list">
            <li>Forgot password workflow</li>
            <li>Secure token generation</li>
            <li>Email-based password reset</li>
            <li>Token expiration management</li>
            <li>Account recovery logging</li>
            <li>Multi-step verification process</li>
            <li>Password strength validation</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Keyboard Shortcuts -->
    <div class="doc-section">
      <h2 class="doc-section-title">‚å®Ô∏è Keyboard Shortcuts</h2>
      <div class="doc-shortcuts">
        <div class="doc-shortcut-item">
          <kbd>Ctrl</kbd> + <kbd>`</kbd>
          <span>Open Command Palette</span>
        </div>
        <div class="doc-shortcut-item">
          <kbd>Ctrl</kbd> + <kbd>E</kbd>
          <span>Add Farm System</span>
        </div>
        <div class="doc-shortcut-item">
          <kbd>Ctrl</kbd> + <kbd>S</kbd>
          <span>Add Server</span>
        </div>
        <div class="doc-shortcut-item">
          <kbd>Esc</kbd>
          <span>Close Modal/Palette</span>
        </div>
        <div class="doc-shortcut-item">
          <kbd>‚Üë</kbd> <kbd>‚Üì</kbd>
          <span>Navigate Command Palette</span>
        </div>
      </div>
    </div>

    <!-- Navigation Structure -->
    <div class="doc-section">
      <h2 class="doc-section-title">üß≠ Navigation Structure</h2>
      <div class="doc-card">
        <h3>Application Sections</h3>
        <div class="doc-nav-structure">
          <div class="doc-nav-section">
            <strong>General</strong>
            <ul>
              <li>Summary Dashboard - System overview and quick actions</li>
            </ul>
          </div>
          <div class="doc-nav-section">
              <!-- Section removed -->
          </div>
          <div class="doc-nav-section">
            <strong>System Administrators</strong>
            <ul>
              <li>Users / Permissions - User management and access control</li>
              <li>Environments - Deployment target configuration</li>
              <li>Remote Desktop Manager - Server connections with RDP</li>
              <li>Integrations - External service connections</li>
              <li>Credentials - Secure credential storage</li>
              <li>Audit Logs - Activity tracking and compliance</li>
              <li>Database Setup - SQL Server integration</li>
              <li>Notifications - Alert configuration and scheduling</li>
            </ul>
          </div>
          <div class="doc-nav-section">
            <strong>Monitoring</strong>
            <ul>
              <li>ElasticSearch - Log analysis and search</li>
            </ul>
          </div>
          <div class="doc-nav-section">
            <strong>Other</strong>
            <ul>
              <li>Documentation - This comprehensive guide</li>
            </ul>
          </div>
          <div class="doc-nav-section">
            <strong>System</strong>
            <ul>
              <li>Settings - Application configuration</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Architecture -->
    <div class="doc-section">
      <h2 class="doc-section-title">üèóÔ∏è Architecture</h2>
      <div class="doc-card">
        <h3>Technology Stack</h3>
        <div class="doc-tech-grid">
          <div class="doc-tech-item">
            <strong>Frontend</strong>
            <p>Vanilla JavaScript, HTML5, CSS3</p>
          </div>
          <div class="doc-tech-item">
            <strong>Storage</strong>
            <p>SQL Server (local/remote)</p>
          </div>
          <div class="doc-tech-item">
            <strong>Backend</strong>
            <p>Node.js + Express (for RDP connections & notifications)</p>
          </div>
          <div class="doc-tech-item">
            <strong>UI Framework</strong>
            <p>Custom CSS with modern features</p>
          </div>
        </div>
      </div>

      <div class="doc-card">
        <h3>Backend Server</h3>
        <p>OrbisHub includes a Node.js backend server for advanced features:</p>
        <ul class="doc-list">
          <li><strong>RDP Connection Service:</strong> Generates temporary RDP files and launches mstsc for one-click server connections</li>
          <li><strong>Notification Dispatch:</strong> Sends notifications via configured integrations (Exchange, SMTP, Slack, Teams)</li>
          <li><strong>Database Operations:</strong> Optional SQL Server integration for enterprise deployments</li>
        </ul>
        <div class="doc-tip">
          <strong>üöÄ Start Backend:</strong> Run <code>npm start</code> or <code>node server.js</code> in the project directory. Server runs on port 3000 by default.
        </div>
      </div>

      <div class="doc-card">
        <h3>Data Structure</h3>
        <p>OrbisHub stores data in SQL Server with the following conceptual schema:</p>
        <pre class="doc-code">
{
  "environments": [],      // Deployment environments
  "servers": [],          // Server infrastructure with RDP details
  "integrations": [],     // External service connections
  "credentials": [],      // Encrypted login credentials
  "users": [],            // User accounts with online status
  "auditLogs": [],        // Complete activity tracking
  "notificationSettings": {}, // Notification configuration
  "locks": {}             // Card lock states
}</pre>
      </div>
    </div>

    <!-- Security -->
    <div class="doc-section">
      <h2 class="doc-section-title">üîí Security</h2>
      <div class="doc-card">
        <h3>Best Practices</h3>
        <ul class="doc-list">
          <li><strong>Authentication:</strong> Always change the default admin password (admin/admin) on first login</li>
          <li><strong>Credentials:</strong> Use the Credentials vault to securely store sensitive data</li>
          <li><strong>Audit Logs:</strong> Regularly review audit logs for suspicious activity</li>
          <li><strong>Sessions:</strong> Sessions are stored securely and expire after inactivity</li>
          <li><strong>HTTPS:</strong> Always deploy OrbisHub over HTTPS in production</li>
        </ul>
      </div>
    </div>

    <!-- API Integration -->
    <div class="doc-section">
      <h2 class="doc-section-title">üîå Backend Integration</h2>
      <div class="doc-card">
        <h3>Optional Node.js Backend</h3>
        <p>OrbisHub can connect to an optional backend for advanced features:</p>
        <ul class="doc-list">
          <li>Database connection testing</li>
          <li>Server health monitoring</li>
        </ul>
        <div class="doc-warning">
          <strong>‚ö†Ô∏è Note:</strong> Backend is optional. The Electron app can work directly with SQL Server.
        </div>
      </div>
    </div>

    <!-- FAQ -->
    <div class="doc-section">
      <h2 class="doc-section-title">‚ùì Frequently Asked Questions</h2>
      
      <div class="doc-faq">
        <details class="doc-faq-item">
          <summary>Where is my data stored?</summary>
          <p>All data is stored in your configured SQL Server database. Data remains on your infrastructure and does not leave your machine/network.</p>
        </details>

        <details class="doc-faq-item">
          <summary>Can I export/import my data?</summary>
          <p>Yes! Use the Database Setup section in Admin Panel to export your entire database to a JSON file, or import data from a backup.</p>
        </details>

        <details class="doc-faq-item">
          <summary>Do I need a backend server?</summary>
          <p>No, OrbisHub works completely standalone in your browser. The optional Node.js backend adds features like database connection testing, but isn't required.</p>
        </details>

        <details class="doc-faq-item">
          <summary>How do I reset everything?</summary>
          <p>Contact your system administrator to reset the database and recreate admin credentials if needed.</p>
        </details>

        <details class="doc-faq-item">
          <summary>What browsers are supported?</summary>
          <p>OrbisHub works on all modern browsers: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+. Mobile browsers are also supported.</p>
        </details>

        <details class="doc-faq-item">
          <summary>What features are available?</summary>
          <div>
            <p>OrbisHub Desktop includes the following comprehensive modules:</p>
            <ul class="doc-list">
              <li><strong>Dashboard & Analytics:</strong> Real-time summary dashboard with system statistics</li>
              <li><strong>User Management:</strong> Role-based access control with permissions and activity tracking</li>
              <li><strong>Environment Management:</strong> Organize infrastructure by deployment targets (Prod, Staging, Dev, Test)</li>
              <li><strong>Remote Desktop Manager:</strong> One-click RDP/SSH connections to servers</li>
              <li><strong>Credential Vault:</strong> AES-256 encrypted credential storage</li>
              <li><strong>Team Messaging:</strong> Secure peer-to-peer communication with file attachments</li>
              <li><strong>Audit Logs:</strong> Complete activity tracking and compliance reporting</li>
              <li><strong>Orbis Agents:</strong> Remote machine monitoring and PowerShell script execution</li>
              <li><strong>Core Service:</strong> ASP.NET Core REST API with Windows Service integration</li>
              <li><strong>Ticket Management:</strong> Issue tracking with projects, priorities, and workflows</li>
              <li><strong>Password Manager:</strong> Secure password vault with generator and strength analyzer</li>
              <li><strong>Bug Reporting:</strong> Streamlined bug submission with severity classification</li>
              <li><strong>Email Server Profiles:</strong> SMTP/Exchange server configuration management</li>
              <li><strong>User Recovery:</strong> Forgot password and account recovery workflows</li>
              <li><strong>Notifications:</strong> Automated alerts and daily summary reports</li>
              <li><strong>Integrations:</strong> External system connections (Exchange, SharePoint, etc.)</li>
              <li><strong>ElasticSearch:</strong> Log analysis and real-time monitoring</li>
            </ul>
          </div>
        </details>
      </div>
    </div>

    <!-- Footer -->
    <div class="doc-footer">
      <p>Built with ‚ù§Ô∏è for DevOps teams by <strong>Ashot Arzakanyan</strong></p>
      <p class="doc-footer-meta">Version 1.5.0 ‚Ä¢ December 2025</p>
    </div>
  </div>
</section>

<!-- Bug Report -->
<section id="view-bug-report" class="view">
  <div class="view__header">
    <h1>üêõ Report a Bug</h1>
  </div>

  <div class="bug-report-container">
    <!-- Form Container -->
    <div id="bugReportFormContainer">
      <div class="bug-report-header">
        <h2 class="bug-report-title">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="8" y="6" width="8" height="12" rx="2" ry="2"></rect>
            <line x1="4" y1="10" x2="4" y2="14"></line>
            <line x1="20" y1="10" x2="20" y2="14"></line>
            <line x1="8" y1="2" x2="16" y2="2"></line>
            <path d="M12 6v2"></path>
          </svg>
          Bug Report
        </h2>
        <p class="bug-report-subtitle">
          Help us improve OrbisHub by reporting bugs and issues. Your feedback is valuable!
          <br>Reports are sent to: <strong>development@orbis-hub.com</strong>
        </p>
      </div>

      <!-- Info Box -->
      <div class="bug-info-box">
        <svg class="bug-info-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="16" x2="12" y2="12"></line>
          <line x1="12" y1="8" x2="12.01" y2="8"></line>
        </svg>
        <div class="bug-info-content">
          <div class="bug-info-title">Tips for effective bug reports</div>
          <div class="bug-info-text">
            Be specific and provide as much detail as possible. Include steps to reproduce, what you expected to happen, and what actually happened. This helps us fix issues faster.
          </div>
        </div>
      </div>

      <!-- Error Message -->
      <div id="bugErrorMessage" class="bug-error-message" style="display:none;"></div>

      <!-- Bug Report Form -->
      <div class="bug-report-form">
        <!-- Basic Information -->
        <div class="bug-form-section">
          <h3 class="bug-section-title">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
            </svg>
            Basic Information
          </h3>

          <div class="bug-form-group">
            <label class="bug-form-label required" for="bugTitle">Bug Title</label>
            <input 
              type="text" 
              id="bugTitle" 
              class="bug-form-input" 
              placeholder="Brief, descriptive title of the issue"
              maxlength="200"
            />
            <span class="bug-form-hint">A clear, concise summary of the bug (minimum 5 characters)</span>
          </div>

          <div class="bug-form-group">
            <label class="bug-form-label required" for="bugDescription">Description</label>
            <textarea 
              id="bugDescription" 
              class="bug-form-textarea large" 
              placeholder="Detailed description of the bug..."
              maxlength="2000"
            ></textarea>
            <div style="display:flex; justify-content:space-between; align-items:center;">
              <span class="bug-form-hint">Provide a detailed description of the issue (minimum 20 characters)</span>
              <span id="bugDescriptionCounter" class="bug-form-hint">0/2000 characters</span>
            </div>
          </div>
        </div>

        <!-- Severity -->
        <div class="bug-form-section">
          <h3 class="bug-section-title">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="8" x2="12" y2="12"></line>
              <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
            Severity Level
          </h3>
          <div id="bugSeverityOptions" class="bug-severity-options"></div>
        </div>

        <!-- Category -->
        <div class="bug-form-section">
          <h3 class="bug-section-title">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="8" y1="6" x2="21" y2="6"></line>
              <line x1="8" y1="12" x2="21" y2="12"></line>
              <line x1="8" y1="18" x2="21" y2="18"></line>
              <line x1="3" y1="6" x2="3.01" y2="6"></line>
              <line x1="3" y1="12" x2="3.01" y2="12"></line>
              <line x1="3" y1="18" x2="3.01" y2="18"></line>
            </svg>
            Category
          </h3>
          <div id="bugCategoryGrid" class="bug-category-grid"></div>
        </div>

        <!-- Additional Details -->
        <div class="bug-form-section">
          <h3 class="bug-section-title">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 11 12 14 22 4"></polyline>
              <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
            </svg>
            Additional Details (Optional)
          </h3>

          <div class="bug-form-group">
            <label class="bug-form-label" for="bugStepsToReproduce">Steps to Reproduce</label>
            <textarea 
              id="bugStepsToReproduce" 
              class="bug-form-textarea" 
              placeholder="1. Go to...&#10;2. Click on...&#10;3. See error..."
            ></textarea>
            <span class="bug-form-hint">List the steps needed to reproduce the bug</span>
          </div>

          <div class="bug-form-row">
            <div class="bug-form-group">
              <label class="bug-form-label" for="bugExpectedBehavior">Expected Behavior</label>
              <textarea 
                id="bugExpectedBehavior" 
                class="bug-form-textarea" 
                placeholder="What should happen..."
              ></textarea>
              <span class="bug-form-hint">What you expected to happen</span>
            </div>

            <div class="bug-form-group">
              <label class="bug-form-label" for="bugActualBehavior">Actual Behavior</label>
              <textarea 
                id="bugActualBehavior" 
                class="bug-form-textarea" 
                placeholder="What actually happened..."
              ></textarea>
              <span class="bug-form-hint">What actually happened</span>
            </div>
          </div>

          <div class="bug-form-group">
            <label class="bug-form-label" for="bugUserEmail">Your Email (Optional)</label>
            <input 
              type="email" 
              id="bugUserEmail" 
              class="bug-form-input" 
              placeholder="your.email@example.com"
            />
            <span class="bug-form-hint">Provide your email if you'd like to receive updates on this bug</span>
          </div>
        </div>

        <!-- Actions -->
        <div class="bug-form-actions">
          <button type="button" id="bugClearBtn" class="bug-clear-btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px;">
              <polyline points="3 6 5 6 21 6"></polyline>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
            Clear Form
          </button>
          <button type="button" id="bugSubmitBtn" class="bug-submit-btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px;">
              <line x1="22" y1="2" x2="11" y2="13"></line>
              <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
            </svg>
            Submit Bug Report
          </button>
        </div>
      </div>
    </div>

    <!-- Success Message -->
    <div id="bugSuccessContainer" class="bug-success-message" style="display:none;">
      <div class="bug-success-icon">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
      </div>
      <h2 class="bug-success-title">Bug Report Submitted!</h2>
      <p class="bug-success-text">
        Thank you for taking the time to report this issue. Your bug report has been successfully sent to our development team at <strong>development@orbis-hub.com</strong>.
        <br><br>
        We appreciate your help in making OrbisHub better!
      </p>
      <div class="bug-success-actions">
        <button id="bugSubmitAnotherBtn" class="btn btn-primary">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px;">
            <polyline points="1 4 1 10 7 10"></polyline>
            <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
          </svg>
          Report Another Bug
        </button>
      </div>
    </div>
  </div>
</section>

<!-- Settings -->
<!-- Settings -->
<section id="view-settings" class="view">
  <div class="view__header">
    <h1>‚öôÔ∏è Settings</h1>
  </div>
  
  <div class="documentation-container">
    <!-- Appearance Section -->
    <div class="doc-section">
      <h2 class="doc-section-title">üé® Appearance</h2>
      <div class="doc-card">
        <div class="settings-row">
          <div class="settings-row-info">
            <h3>Compact Mode</h3>
            <p>Reduce spacing and padding for a denser layout</p>
          </div>
          <div class="settings-row-control">
            <label class="toggle-switch">
              <input type="checkbox" id="settingsCompactMode">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <div class="settings-row">
          <div class="settings-row-info">
            <h3>Font Size</h3>
            <p>Adjust the base font size for better readability</p>
          </div>
          <div class="settings-row-control">
            <select class="input" id="settingsFontSize" style="width: 150px;">
              <option value="small">Small (13px)</option>
              <option value="medium" selected>Medium (14px)</option>
              <option value="large">Large (16px)</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- Notifications & Alerts Section -->
    <div class="doc-section">
      <h2 class="doc-section-title">üîî Notifications & Alerts</h2>
      <div class="doc-card">
        <div class="settings-row">
          <div class="settings-row-info">
            <h3>Desktop Notifications</h3>
            <p>Show browser notifications for important events</p>
          </div>
          <div class="settings-row-control">
            <label class="toggle-switch">
              <input type="checkbox" id="settingsDesktopNotifications" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <div class="settings-row">
          <div class="settings-row-info">
            <!-- Section removed -->
          </div>
          <div class="settings-row-control">
            
          </div>
        </div>

        <div class="settings-row">
          <div class="settings-row-info">
            <h3>Error Notifications</h3>
            <p>Display alerts when operations fail</p>
          </div>
          <div class="settings-row-control">
            <label class="toggle-switch">
              <input type="checkbox" id="settingsErrorNotifications" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <div class="settings-row">
          <div class="settings-row-info">
            <h3>Sound Effects</h3>
            <p>Play sounds for notifications and alerts</p>
          </div>
          <div class="settings-row-control">
            <label class="toggle-switch">
              <input type="checkbox" id="settingsSoundEffects">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>
      </div>
    </div>

    <!-- Auto-Refresh & Updates Section -->
    <div class="doc-section">
      <h2 class="doc-section-title">üîÑ Auto-Refresh & Updates</h2>
      <div class="doc-card">
        <div class="settings-row">
          <div class="settings-row-info">
            <h3>Auto-Refresh Dashboard</h3>
            <p>Automatically refresh data at regular intervals</p>
          </div>
          <div class="settings-row-control">
            <label class="toggle-switch">
              <input type="checkbox" id="settingsAutoRefresh">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <div class="settings-row">
          <div class="settings-row-info">
            <h3>Refresh Interval</h3>
            <p>Set how often data should auto-refresh</p>
          </div>
          <div class="settings-row-control">
            <select class="input" id="settingsRefreshInterval" style="width: 150px;">
              <option value="10">10 seconds</option>
              <option value="30">30 seconds</option>
              <option value="60" selected>1 minute</option>
              <option value="300">5 minutes</option>
              <option value="600">10 minutes</option>
              <option value="1800">30 minutes</option>
            </select>
          </div>
        </div>

        <div class="settings-row">
          <div class="settings-row-info">
            <!-- Section removed -->
          </div>
          <div class="settings-row-control">
            
          </div>
        </div>
      </div>
    </div>

    <!-- Data Management Section -->
    <div class="doc-section">
      <h2 class="doc-section-title">üíæ Data Management</h2>
      <div class="doc-card">
        <div class="settings-row">
          <div class="settings-row-info">
            <h3>Database Usage</h3>
            <p>Monitor your database usage</p>
          </div>
          <div class="settings-row-control">
            <div id="storageUsageDisplay" class="storage-usage">
              <span id="storageUsageText" class="muted" style="font-size: 14px; font-weight: 600;">0.00 MB / 5 MB (0.0%)</span>
              <div class="storage-bar">
                <div class="storage-bar-fill" id="storageBarFill" style="width: 0%;"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="settings-row">
          <div class="settings-row-info">
            <h3>Auto-Backup</h3>
            <p>Automatically backup your data daily</p>
          </div>
          <div class="settings-row-control">
            <label class="toggle-switch">
              <input type="checkbox" id="settingsAutoBackup">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <div class="settings-row">
          <div class="settings-row-info">
            <h3>Data Retention</h3>
            <p>How long to keep audit logs</p>
          </div>
          <div class="settings-row-control">
            <select class="input" id="settingsDataRetention" style="width: 150px;">
              <option value="7">7 days</option>
              <option value="30" selected>30 days</option>
              <option value="90">90 days</option>
              <option value="365">1 year</option>
              <option value="-1">Forever</option>
            </select>
          </div>
        </div>

        <div class="settings-row">
          <div class="settings-row-info">
            <h3>Export Format</h3>
            <p>Choose default format for data exports</p>
          </div>
          <div class="settings-row-control">
            <select class="input" id="settingsExportFormat" style="width: 150px;">
              <option value="json" selected>JSON</option>
              <option value="csv">CSV</option>
              <option value="xml">XML</option>
            </select>
          </div>
        </div>

        <div class="settings-row">
          <div class="settings-row-info">
            <h3>Export Data</h3>
            <p>Download all your data as a backup file</p>
          </div>
          <div class="settings-row-control">
            <button class="btn btn-ghost" id="exportDataBtn" style="display: flex; align-items: center; gap: 8px;">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
              </svg>
              Export Database
            </button>
          </div>
        </div>

        <div class="settings-row">
          <div class="settings-row-info">
            <h3>Import Data</h3>
            <p>Restore data from a backup file</p>
          </div>
          <div class="settings-row-control">
            <button class="btn btn-ghost" id="importDataBtn" style="display: flex; align-items: center; gap: 8px;">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
              </svg>
              Import Database
            </button>
            <input type="file" id="importDataFile" accept=".json" style="display:none;">
          </div>
        </div>

        <div class="settings-row" style="background: rgba(239, 68, 68, 0.05); border-radius: 8px; padding: 16px; margin-top: 12px;">
          <div class="settings-row-info">
            <h3>Clear All Data</h3>
            <p>Reset OrbisHub to factory defaults (cannot be undone)</p>
          </div>
          <div class="settings-row-control">
            <button class="btn" id="clearAllDataBtn" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; border: none; display: flex; align-items: center; gap: 8px;" data-permissions-any="settings:delete,*:*">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg>
              Clear All Data
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Security & Privacy Section -->
    <div class="doc-section">
      <h2 class="doc-section-title">üîí Security & Privacy</h2>
      <div class="doc-card">
        <div class="settings-row">
          <div class="settings-row-info">
            <h3>Auto-Lock Session</h3>
            <p>Automatically lock after period of inactivity</p>
          </div>
          <div class="settings-row-control">
            <label class="toggle-switch">
              <input type="checkbox" id="settingsAutoLock">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <div class="settings-row">
          <div class="settings-row-info">
            <h3>Session Timeout</h3>
            <p>Time before auto-lock activates</p>
          </div>
          <div class="settings-row-control">
            <select class="input" id="settingsSessionTimeout" style="width: 150px;">
              <option value="5">5 minutes</option>
              <option value="15" selected>15 minutes</option>
              <option value="30">30 minutes</option>
              <option value="60">1 hour</option>
            </select>
          </div>
        </div>

        <div class="settings-row">
          <div class="settings-row-info">
            <h3>Show Passwords</h3>
            <p>Display passwords in plain text (less secure)</p>
          </div>
          <div class="settings-row-control">
            <label class="toggle-switch">
              <input type="checkbox" id="settingsShowPasswords">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <div class="settings-row">
          <div class="settings-row-info">
            <h3>Audit Logging</h3>
            <p>Track all user actions and system events</p>
          </div>
          <div class="settings-row-control">
            <label class="toggle-switch">
              <input type="checkbox" id="settingsAuditLogging" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>
      </div>
    </div>

    <!-- Performance Section -->
    <div class="doc-section">
      <h2 class="doc-section-title">‚ö° Performance</h2>
      <div class="doc-card">
        <div class="settings-row">
          <div class="settings-row-info">
            <h3>Animations</h3>
            <p>Enable smooth transitions and animations</p>
          </div>
          <div class="settings-row-control">
            <label class="toggle-switch">
              <input type="checkbox" id="settingsAnimations" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <div class="settings-row">
          <div class="settings-row-info">
            <h3>Lazy Loading</h3>
            <p>Load data only when needed to improve speed</p>
          </div>
          <div class="settings-row-control">
            <label class="toggle-switch">
              <input type="checkbox" id="settingsLazyLoading" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <div class="settings-row">
          <div class="settings-row-info">
            <h3>Items Per Page</h3>
            <p>Number of items to display in lists</p>
          </div>
          <div class="settings-row-control">
            <select class="input" id="settingsItemsPerPage" style="width: 150px;">
              <option value="10">10 items</option>
              <option value="25">25 items</option>
              <option value="50" selected>50 items</option>
              <option value="100">100 items</option>
              <option value="-1">Show all</option>
            </select>
          </div>
        </div>

        <div class="settings-row">
          <div class="settings-row-info">
            <h3>Cache Duration</h3>
            <p>How long to cache data before refreshing</p>
          </div>
          <div class="settings-row-control">
            <select class="input" id="settingsCacheDuration" style="width: 150px;">
              <option value="0">No cache</option>
              <option value="60">1 minute</option>
              <option value="300" selected>5 minutes</option>
              <option value="900">15 minutes</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- System Information Section -->
    <div class="doc-section">
      <h2 class="doc-section-title">‚ÑπÔ∏è System Information</h2>
      <div class="doc-tech-grid">
        <div class="doc-tech-item">
          <strong>Version</strong>
          <p>1.0</p>
        </div>
        <div class="doc-tech-item">
          <strong>Author</strong>
          <p>Ashot Arzakanyan</p>
        </div>
        <div class="doc-tech-item">
          <strong>Browser</strong>
          <p id="browserInfo">Chrome</p>
        </div>
        <div class="doc-tech-item">
          <strong>Storage Type</strong>
          <p>SQL Server</p>
        </div>
        <div class="doc-tech-item">
          <strong>Last Backup</strong>
          <p id="lastBackupInfo">Never</p>
        </div>
        <div class="doc-tech-item">
          <strong>Total Records</strong>
          <p id="totalRecordsInfo">0</p>
        </div>
      </div>
    </div>

    <!-- Keyboard Shortcuts Section -->
    <div class="doc-section">
      <h2 class="doc-section-title">‚å®Ô∏è Keyboard Shortcuts</h2>
      <div class="doc-shortcuts">
        <div class="doc-shortcut-item">
          <kbd>Ctrl</kbd> + <kbd>`</kbd>
          <span>Command Palette</span>
        </div>
        <div class="doc-shortcut-item">
          <kbd>Ctrl</kbd> + <kbd>E</kbd>
          <span>Add Farm System</span>
        </div>
        <div class="doc-shortcut-item">
          <kbd>Ctrl</kbd> + <kbd>S</kbd>
          <span>Add Server</span>
        </div>
        <div class="doc-shortcut-item">
          <kbd>Esc</kbd>
          <span>Close Modal/Palette</span>
        </div>
        <div class="doc-shortcut-item">
          <kbd>Ctrl</kbd> + <kbd>,</kbd>
          <span>Open Settings</span>
        </div>
      </div>
    </div>
  </div>
</section>

</div>
</main>


<!-- Modals -->
<dialog id="envModal" class="modal">
<form class="card">
<h2>Add Farm System</h2>
<label class="label">Display name
<input id="envName" class="input" placeholder="e.g., Prod EU" required />
</label>
<label class="label">URL
<input id="envUrl" class="input" placeholder="https://org.crm.dynamics.com" required />
</label>
<label class="label">Type
<select id="envType" class="input">
<option>Production</option>
<option>Stage</option>
<option>Test</option>
<option>Dev</option>
</select>
</label>
 
<menu class="row end">
<button id="saveEnvBtn" type="submit" value="default" class="btn">Save</button>
</menu>
<button type="button" value="cancel" class="modal-close-btn" title="Close" tabindex="-1">
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
    <line x1="18" y1="6" x2="6" y2="18"></line>
    <line x1="6" y1="6" x2="18" y2="18"></line>
  </svg>
</button>
</form>
</dialog>

<dialog id="editEnvModal" class="modal">
<form class="card">
<h2>Edit Environment</h2>
<input type="hidden" id="editEnvId" />
<label class="label">Display name
<input id="editEnvName" class="input" placeholder="e.g., Prod EU" required />
</label>
<label class="label">URL
<input id="editEnvUrl" class="input" placeholder="https://org.crm.dynamics.com" required />
</label>
<label class="label">Type
<select id="editEnvType" class="input">
<option>Production</option>
<option>Stage</option>
<option>Test</option>
<option>Dev</option>
</select>
</label>
 
<menu class="row end">
<button id="saveEditEnvBtn" type="submit" value="default" class="btn">Save Changes</button>
</menu>
<button type="button" value="cancel" class="modal-close-btn" title="Close" tabindex="-1">
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
    <line x1="18" y1="6" x2="6" y2="18"></line>
    <line x1="6" y1="6" x2="18" y2="18"></line>
  </svg>
</button>
</form>
</dialog>

<dialog id="confirmModal" class="modal">
<form method="dialog" class="card card--compact">
<h2>Clear All Jobs</h2>
<p class="muted">Are you sure you want to clear all jobs? This action cannot be undone.</p>
<menu class="row end">
<button value="cancel" class="btn btn-ghost">Cancel</button>
<button value="confirm" class="btn btn-danger">Clear All Jobs</button>
</menu>
</form>
</dialog>

<dialog id="mapServersModal" class="modal">
<form method="dialog" class="card" style="max-width:600px;">
<button type="submit" value="cancel" class="modal-close-btn" title="Close">
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
    <line x1="18" y1="6" x2="6" y2="18"></line>
    <line x1="6" y1="6" x2="18" y2="18"></line>
  </svg>
</button>
<h2>Map Agent to <span id="mapServersEnvName"></span></h2>
<p style="color:var(--muted); font-size:14px; margin-bottom:20px;">Select an OrbisAgent to monitor uptime for this Farm System.</p>

<label class="label">Available Agents
<div id="mapServersAllTypes" style="max-height: 400px; overflow-y: auto; border: 1px solid var(--border); border-radius: 8px; padding: 12px;">
<div style="color: var(--muted); font-size: 14px; padding: 8px;">Loading agents...</div>
</div>
</label>
<menu class="row end">
<button id="saveMapServersBtn" type="submit" value="default" class="btn">Save Mapping</button>
</menu>
</form>
</dialog>

<dialog id="deleteEnvModal" class="modal">
<form method="dialog" class="card card--compact">
<h2>Delete Environment</h2>
<p class="muted">Are you sure you want to delete "<span id="deleteEnvName"></span>"? This action cannot be undone.</p>
<menu class="row end">
<button value="cancel" class="btn btn-ghost">Cancel</button>
<button value="confirm" class="btn btn-danger">Delete Environment</button>
</menu>
</form>
</dialog>

<dialog id="deleteUserModal" class="modal">
<form method="dialog" class="card">
<h2 style="color: var(--text);">Delete User</h2>
<p style="color: var(--text);">Are you sure you want to delete <strong><span id="deleteUserName"></span></strong>?</p>
<menu class="row end">
<button value="cancel" class="btn btn-ghost">Cancel</button>
<button id="confirmDeleteUserBtn" type="submit" value="confirm" class="btn btn-danger">Delete</button>
</menu>
</form>
</dialog>

<!-- Update Notification Modal -->
<div id="updateNotification" class="update-notification" style="display: none;">
  <div class="update-notification__content">
    <div class="update-notification__icon">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        <path d="M12 8v4l3 3"></path>
      </svg>
    </div>
    <div class="update-notification__body">
      <h3 id="updateNotificationTitle">Update Available</h3>
      <p id="updateNotificationMessage">A new version is available</p>
      <div id="updateProgressBar" class="update-progress" style="display: none;">
        <div id="updateProgressFill" class="update-progress__fill"></div>
        <span id="updateProgressText" class="update-progress__text">0%</span>
      </div>
    </div>
    <div class="update-notification__actions">
      <button id="updateDismissBtn" class="btn btn-sm btn-ghost">Later</button>
      <button id="updateDownloadBtn" class="btn btn-sm">Download</button>
      <button id="updateInstallBtn" class="btn btn-sm" style="display: none;">Restart & Install</button>
    </div>
  </div>
</div>

</body>
</html>

<dialog id="editUserModal" class="modal">
<form class="card">
<h2>Edit User</h2>
<input type="hidden" id="editUserId" />
<label class="label">Full name
<input id="editUserName" class="input" placeholder="Full name" required />
</label>
<label class="label">Username
<input id="editUserUsername" class="input" placeholder="Username" required />
</label>
<label class="label">Password
<input id="editUserPassword" type="password" class="input" placeholder="Leave empty to keep current" />
</label>
<div id="editUserPasswordError" style="display: none; padding: 12px; background: color-mix(in srgb, #ef4444 15%, var(--panel)); border: 1px solid color-mix(in srgb, #ef4444 40%, transparent); border-radius: 8px; margin-top: 8px;">
  <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#fca5a5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="15" y1="9" x2="9" y2="15"></line>
      <line x1="9" y1="9" x2="15" y2="15"></line>
    </svg>
    <strong style="color: #fca5a5; font-size: 13px;">Password Requirements Not Met</strong>
  </div>
  <ul id="editUserPasswordErrorList" style="margin: 0; padding-left: 20px; color: #fca5a5; font-size: 12px; line-height: 1.6;">
  </ul>
</div>
<label class="label" style="display:flex; align-items:center; gap:8px; margin-top:8px;">
<input id="editUserChangePassword" type="checkbox" style="width:auto; margin:0;" />
<span style="font-weight:normal;">Change password on next logon</span>
</label>
<label class="label">Email
<input id="editUserEmail" class="input" placeholder="Email address" required />
</label>
<label class="label">Position
<input id="editUserPosition" class="input" placeholder="e.g., Senior Admin, Developer" />
</label>
<label class="label">Squad
<input id="editUserSquad" class="input" placeholder="e.g., DevOps, QA Team" />
</label>
<label class="label">Role
<select id="editUserRole" class="input">
<option>Super Admin</option>
<option>Admin</option>
<option>Manager</option>
<option>Operator</option>
<option>Viewer</option>
</select>
</label>
<menu class="row end">
<button id="saveEditUserBtn" type="submit" value="default" class="btn">Save Changes</button>
</menu>
<button type="button" value="cancel" class="modal-close-btn" title="Close" tabindex="-1">
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
    <line x1="18" y1="6" x2="6" y2="18"></line>
    <line x1="6" y1="6" x2="18" y2="18"></line>
  </svg>
</button>
</form>
</dialog>

<dialog id="createUserModal" class="modal">
<form class="card">
<h2>Create User</h2>
<label class="label">Full name
<input id="userName" class="input" placeholder="Full name" required />
</label>
<label class="label">Username
<input id="userUsername" class="input" placeholder="Username" required />
</label>
<label class="label">Password
<input id="userPassword" type="password" class="input" placeholder="Password" required />
</label>
<div id="createUserPasswordError" style="display: none; padding: 12px; background: color-mix(in srgb, #ef4444 15%, var(--panel)); border: 1px solid color-mix(in srgb, #ef4444 40%, transparent); border-radius: 8px; margin-top: 8px;">
  <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#fca5a5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="15" y1="9" x2="9" y2="15"></line>
      <line x1="9" y1="9" x2="15" y2="15"></line>
    </svg>
    <strong style="color: #fca5a5; font-size: 13px;">Password Requirements Not Met</strong>
  </div>
  <ul id="createUserPasswordErrorList" style="margin: 0; padding-left: 20px; color: #fca5a5; font-size: 12px; line-height: 1.6;">
  </ul>
</div>
<label class="label" style="display:flex; align-items:center; gap:8px; margin-top:8px;">
<input id="userChangePassword" type="checkbox" style="width:auto; margin:0;" />
<span style="font-weight:normal;">Change password on next logon</span>
</label>
<label class="label">Email
<input id="userEmail" class="input" placeholder="Email address" required />
</label>
<label class="label">Position
<input id="userPosition" class="input" placeholder="e.g., Senior Admin, Developer" />
</label>
<label class="label">Squad
<input id="userSquad" class="input" placeholder="e.g., DevOps, QA Team" />
</label>
<label class="label">Role
<select id="userRole" class="input">
<option>Super Admin</option>
<option>Admin</option>
<option>Manager</option>
<option>Operator</option>
<option>Viewer</option>
</select>
</label>
<menu class="row end">
<button id="createUserBtn" type="submit" value="default" class="btn">Create User</button>
</menu>
<button type="button" value="cancel" class="modal-close-btn" title="Close" tabindex="-1">
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
    <line x1="18" y1="6" x2="6" y2="18"></line>
    <line x1="6" y1="6" x2="18" y2="18"></line>
  </svg>
</button>
</form>
</dialog>

<!-- Credential Modals -->
<dialog id="credentialModal" class="modal">
<form class="card">
<h2>Add Credential</h2>
<label class="label">Credential Name
<input id="credName" class="input" placeholder="e.g., Admin Account, API Key" required />
</label>
<label class="label">Type
<select id="credType" class="input">
<option>Username/Password</option>
<option>Windows Credentials</option>
<option>API Key</option>
<option>OAuth Token</option>
<option>SSH Key</option>
<option>Certificate</option>
<option>Other</option>
</select>
</label>
<label class="label">Username
<input id="credUsername" class="input" placeholder="Username or key identifier" />
</label>
<label class="label">Password / Secret
<input id="credPassword" type="password" class="input" placeholder="Password, token, or secret" />
</label>
<label class="label">Description
<input id="credDescription" class="input" placeholder="Optional description" />
</label>
<menu class="row end">
<button id="saveCredBtn" type="submit" value="default" class="btn">Save</button>
</menu>
<button type="button" value="cancel" class="modal-close-btn" title="Close" tabindex="-1">
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
    <line x1="18" y1="6" x2="6" y2="18"></line>
    <line x1="6" y1="6" x2="18" y2="18"></line>
  </svg>
</button>
</form>
</dialog>

<dialog id="editCredentialModal" class="modal">
<form class="card">
<h2>Edit Credential</h2>
<input type="hidden" id="editCredId" />
<label class="label">Credential Name
<input id="editCredName" class="input" placeholder="e.g., Admin Account, API Key" required />
</label>
<label class="label">Type
<select id="editCredType" class="input">
<option>Username/Password</option>
<option>Windows Credentials</option>
<option>API Key</option>
<option>OAuth Token</option>
<option>SSH Key</option>
<option>Certificate</option>
<option>Other</option>
</select>
</label>
<label class="label">Username
<input id="editCredUsername" class="input" placeholder="Username or key identifier" />
</label>
<label class="label">Password / Secret
<input id="editCredPassword" type="password" class="input" placeholder="Leave empty to keep current" />
</label>
<label class="label">Description
<input id="editCredDescription" class="input" placeholder="Optional description" />
</label>
<menu class="row end">
<button id="saveEditCredBtn" type="submit" value="default" class="btn">Save Changes</button>
</menu>
<button type="button" value="cancel" class="modal-close-btn" title="Close" tabindex="-1">
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
    <line x1="18" y1="6" x2="6" y2="18"></line>
    <line x1="6" y1="6" x2="18" y2="18"></line>
  </svg>
</button>
</form>
</dialog>

<dialog id="deleteCredentialModal" class="modal">
<form method="dialog" class="card">
<h2>Delete Credential</h2>
<p>Are you sure you want to delete this credential? This action cannot be undone.</p>
<menu class="row end">
<button value="cancel" class="btn btn-ghost">Cancel</button>
<button id="confirmDeleteCredBtn" type="submit" value="default" class="btn btn-danger">Delete</button>
</menu>
</form>
</dialog>

<!-- Email Server Profile Modals -->
<!-- Modals loaded dynamically from Functions/EmailServerProfile/email-modals.html -->

<dialog id="clearAuditModal" class="modal">
<form method="dialog" class="card" style="max-width:500px;">
<div style="display:flex; align-items:center; gap:16px; margin-bottom:20px;">
<div style="width:48px; height:48px; border-radius:12px; background:rgba(239,68,68,0.1); display:flex; align-items:center; justify-content:center; flex-shrink:0;">
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
<path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
<line x1="12" y1="9" x2="12" y2="13"></line>
<line x1="12" y1="17" x2="12.01" y2="17"></line>
</svg>
</div>
<div style="flex:1;">
<h2 style="margin:0 0 8px 0;">Clear Audit History?</h2>
<p style="margin:0; color:var(--muted); font-size:14px;">This will permanently delete all audit log entries. This action cannot be undone.</p>
</div>
</div>
<menu class="row end">
<button value="cancel" class="btn btn-ghost">Cancel</button>
<button id="confirmClearAuditBtn" type="submit" value="default" class="btn btn-danger">Clear All History</button>
</menu>
</form>
</dialog>

<!-- Permissions Management Modals -->
<dialog id="editRoleModal" class="modal">
<form method="dialog" class="card" style="max-width:700px; max-height:80vh; overflow-y:auto;">
<h2 style="margin:0 0 20px 0;">Edit Role Permissions</h2>
<div id="editRoleContent">
  <div class="spinner"></div>
</div>
<menu class="row end" style="margin-top:24px;">
<button value="cancel" class="btn btn-ghost">Cancel</button>
<button id="saveRolePermissionsBtn" type="submit" value="default" class="btn btn-primary">Save Changes</button>
</menu>
</form>
</dialog>

<dialog id="assignRoleModal" class="modal">
<form method="dialog" class="card" style="max-width:500px;">
<h2 style="margin:0 0 8px 0;">Manage User Roles</h2>
<p id="assignRoleUserName" class="muted" style="margin:0 0 20px 0;"></p>
<div id="assignRoleContent" style="max-height:400px; overflow-y:auto;">
  <div class="spinner"></div>
</div>
<menu class="row end" style="margin-top:24px;">
<button value="cancel" class="btn btn-ghost">Cancel</button>
<button id="saveUserRolesBtn" type="submit" value="default" class="btn btn-primary">Save Changes</button>
</menu>
</form>
</dialog>

<dialog id="createRoleModal" class="modal">
<form method="dialog" class="card" style="max-width:700px; max-height:80vh; overflow-y:auto;">
<h2 style="margin:0 0 20px 0;">Create Custom Role</h2>
<div style="margin-bottom:24px;">
  <div style="margin-bottom:16px;">
    <label class="form-label" style="display:block; margin-bottom:4px; font-weight:600;">Role Name *</label>
    <input type="text" id="newRoleName" class="form-control" placeholder="e.g., Technician, Support Staff" required style="width:100%;">
  </div>
  <div style="margin-bottom:16px;">
    <label class="form-label" style="display:block; margin-bottom:4px; font-weight:600;">Display Name</label>
    <input type="text" id="newRoleDisplayName" class="form-control" placeholder="e.g., Support Technician" style="width:100%;">
  </div>
  <div style="margin-bottom:16px;">
    <label class="form-label" style="display:block; margin-bottom:4px; font-weight:600;">Description</label>
    <textarea id="newRoleDescription" class="form-control" rows="2" placeholder="Describe the role's purpose and responsibilities..." style="width:100%; resize:vertical;"></textarea>
  </div>
  <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px;">
    <div>
      <label class="form-label" style="display:block; margin-bottom:4px; font-weight:600;">Level *</label>
      <input type="number" id="newRoleLevel" class="form-control" min="1" max="100" value="10" required style="width:100%;">
      <p class="muted" style="font-size:11px; margin:4px 0 0 0;">Higher levels have more authority (1-100)</p>
    </div>
    <div>
      <label class="form-label" style="display:block; margin-bottom:4px; font-weight:600;">Color</label>
      <input type="color" id="newRoleColor" class="form-control" value="#6366f1" style="width:100%; height:38px;">
    </div>
  </div>
</div>
<div style="margin-bottom:16px;">
  <h4 style="margin:0 0 12px 0; font-size:15px;">Assign Permissions</h4>
  <p class="muted" style="font-size:12px; margin:0 0 16px 0;">Select the permissions for this role. You can modify these later.</p>
  <div id="createRolePermissions">
    <div class="spinner"></div>
  </div>
</div>
<menu class="row end" style="margin-top:24px;">
<button value="cancel" class="btn btn-ghost">Cancel</button>
<button id="saveNewRoleBtn" type="submit" value="default" class="btn btn-primary">Create Role</button>
</menu>
</form>
</dialog>

















<!-- Custom Confirm Dialog -->
<dialog id="customConfirmModal" class="modal">
<form method="dialog" class="card" style="max-width:450px;">
<div style="display:flex; align-items:flex-start; gap:16px; margin-bottom:24px;">
<div style="width:48px; height:48px; border-radius:50%; background:color-mix(in srgb, #ef4444 10%, var(--panel)); display:flex; align-items:center; justify-content:center; flex-shrink:0;">
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
<circle cx="12" cy="12" r="10"></circle>
<line x1="12" y1="8" x2="12" y2="12"></line>
<line x1="12" y1="16" x2="12.01" y2="16"></line>
</svg>
</div>
<div style="flex:1; min-width:0;">
<h2 id="confirmTitle" style="margin:0 0 8px 0; font-size:18px;">Confirm Action</h2>
<p id="confirmMessage" style="margin:0; color:var(--muted); font-size:14px; line-height:1.5;"></p>
</div>
</div>
<menu class="row end" style="gap:12px; margin:0;">
<button type="submit" value="cancel" class="btn btn-ghost" id="confirmCancelBtn">Cancel</button>
<button type="button" class="btn btn-danger" id="confirmOkBtn">OK</button>
</menu>
</form>
</dialog>

<dialog id="messagesModal" class="modal">
<form method="dialog" class="card" style="max-width:900px; height:600px; display:flex; flex-direction:column; padding:0;">
<button type="submit" value="cancel" class="modal-close-btn" title="Close" style="position:absolute; top:12px; right:12px; z-index:10;">
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
    <line x1="18" y1="6" x2="6" y2="18"></line>
    <line x1="6" y1="6" x2="18" y2="18"></line>
  </svg>
</button>
<div style="padding:20px; border-bottom:1px solid var(--border);">
<h2 style="margin:0;">Messages</h2>
</div>
<div style="display:flex; flex:1; overflow:hidden;">
<!-- Conversations List -->
<div id="conversationsList" style="width:280px; border-right:1px solid var(--border); display:flex; flex-direction:column; overflow:hidden;">
<!-- Tabs for Direct Messages and Channels -->
<div style="display:flex; border-bottom:1px solid var(--border);">
<button type="button" id="directMessagesTab" class="tab-btn active" style="flex:1; padding:12px; border:none; background:transparent; cursor:pointer; border-bottom:2px solid var(--primary); font-weight:600; color:var(--primary);">
Direct Messages
</button>
<button type="button" id="channelsTab" class="tab-btn" style="flex:1; padding:12px; border:none; background:transparent; cursor:pointer; border-bottom:2px solid transparent; font-weight:600; color:var(--muted);">
Channels
</button>
</div>
<div style="padding:12px; border-bottom:1px solid var(--border);">
<input id="searchUsers" class="input" placeholder="Search..." style="width:100%;" />
<button type="button" id="createChannelBtn" class="btn" style="width:100%; margin-top:8px; display:none; font-size:12px; padding:8px;">+ Create Channel</button>
</div>
<div id="conversationsContainer" style="flex:1; overflow-y:auto; padding:8px;">
<!-- Conversations will be populated here -->
</div>
<div id="channelsContainer" style="flex:1; overflow-y:auto; padding:8px; display:none;">
<!-- Channels will be populated here -->
</div>
</div>
<!-- Chat Area -->
<div id="chatArea" style="flex:1; display:flex; flex-direction:column; overflow:hidden;">
<div id="noChatSelected" style="flex:1; display:flex; align-items:center; justify-content:center; color:var(--muted); flex-direction:column; gap:12px;">
<svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
</svg>
<p>Select a conversation to start messaging</p>
</div>
<!-- Chat Header -->
<div id="chatHeader" style="padding:16px; border-bottom:1px solid var(--border); display:none;">
<div style="display:flex; align-items:center; gap:12px;">
<div style="width:40px; height:40px; border-radius:50%; background:linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); display:flex; align-items:center; justify-content:center; color:white; font-weight:600; font-size:16px;" id="chatUserAvatar">
</div>
<div style="flex:1;">
<div id="chatUserName" style="font-weight:600; font-size:14px;"></div>
<div id="chatUserStatus" style="font-size:12px; color:var(--muted);"></div>
</div>
</div>
</div>
<!-- Messages Container -->
<div id="messagesContainer" style="flex:1; overflow-y:auto; padding:16px; display:none;">
<!-- Messages will be populated here -->
</div>
<!-- Message Input -->
<div id="messageInput" style="padding:16px; border-top:1px solid var(--border); display:none;">
<div id="typingIndicator" style="display:none; font-size:12px; color:var(--muted); margin-bottom:8px; height:16px;">
<span id="typingUsername"></span> is typing...
</div>
<div style="display:flex; gap:8px;">
<textarea id="messageTextarea" class="input" placeholder="Type a message..." rows="2" style="flex:1; resize:none; font-family:inherit;"></textarea>
<button type="button" id="sendMessageBtn" class="btn" style="align-self:flex-end;">Send</button>
</div>
</div>
</div>
</div>
</form>
</dialog>

<!-- Create Channel Modal -->
<dialog id="createChannelDialog" class="modal">
<form method="dialog" class="card" style="max-width:500px;">
<button type="submit" value="cancel" class="modal-close-btn" title="Close">
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
    <line x1="18" y1="6" x2="6" y2="18"></line>
    <line x1="6" y1="6" x2="18" y2="18"></line>
  </svg>
</button>
<h2>Create Channel</h2>
<label class="label">Channel Name
<input id="channelName" class="input" placeholder="e.g., General, Announcements" required />
</label>
<label class="label">Description (Optional)
<textarea id="channelDescription" class="input" rows="2" placeholder="What is this channel about?"></textarea>
</label>
<label class="label">Add Members
<div id="channelMembersList" style="max-height:200px; overflow-y:auto; border:1px solid var(--border); border-radius:8px; padding:8px; margin-top:8px;">
<!-- Member checkboxes will be populated here -->
</div>
</label>
<div style="display:flex; gap:12px; margin-top:16px;">
<button type="button" id="createChannelSubmit" class="btn">Create Channel</button>
<button type="submit" value="cancel" class="btn-secondary">Cancel</button>
</div>
</form>
</dialog>

<dialog id="serverModal" class="modal">
<form class="card">
<h2>Add Server</h2>
<label class="label">Display Name
<input id="serverDisplayName" class="input" placeholder="e.g., Web Server 01" required />
</label>
<label class="label">Hostname
<input id="serverHostname" class="input" placeholder="e.g., web-server-01.local" required />
</label>
<label class="label">IP Address
<input id="serverIp" class="input" placeholder="e.g., 192.168.1.100" required />
</label>
<label class="label">Server Type
<select id="serverType" class="input" required>
<option value="">-- Select Type --</option>
<option value="Back End">Back End</option>
<option value="Front End">Front End</option>
<option value="Web Server">Web Server</option>
<option value="Win Server">Win Server</option>
</select>
</label>
<label class="label">Operating System
<select id="serverOS" class="input" required>
<option value="Windows">Windows</option>
<option value="Linux">Linux</option>
</select>
</label>
<label class="label">Group
<select id="serverGroup" class="input">
<option value="">-- Select Group --</option>
<option value="Production">Production</option>
<option value="Stage">Stage</option>
<option value="Test">Test</option>
<option value="Dev">Dev</option>
</select>
</label>
<menu class="row end">
<button id="saveServerBtn" type="submit" value="default" class="btn">Add Server</button>
</menu>
<button type="button" value="cancel" class="modal-close-btn" title="Close" tabindex="-1">
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
    <line x1="18" y1="6" x2="6" y2="18"></line>
    <line x1="6" y1="6" x2="18" y2="18"></line>
  </svg>
</button>
</form>
</dialog>

<dialog id="editServerModal" class="modal">
<form class="card">
<h2>Edit Server</h2>
<input type="hidden" id="editServerId" />
<label class="label">Display Name
<input id="editServerDisplayName" class="input" placeholder="e.g., Web Server 01" required />
</label>
<label class="label">Hostname
<input id="editServerHostname" class="input" placeholder="e.g., web-server-01.local" required />
</label>
<label class="label">IP Address
<input id="editServerIp" class="input" placeholder="e.g., 192.168.1.100" required />
</label>
<label class="label">Server Type
<select id="editServerType" class="input" required>
<option value="">-- Select Type --</option>
<option value="Back End">Back End</option>
<option value="Front End">Front End</option>
<option value="Web Server">Web Server</option>
<option value="Win Server">Win Server</option>
</select>
</label>
<label class="label">Operating System
<select id="editServerOS" class="input" required>
<option value="Windows">Windows</option>
<option value="Linux">Linux</option>
</select>
</label>
<label class="label">Group
<select id="editServerGroup" class="input">
<option value="">-- Select Group --</option>
<option value="Production">Production</option>
<option value="Stage">Stage</option>
<option value="Test">Test</option>
<option value="Dev">Dev</option>
</select>
</label>
<menu class="row end">
<button id="saveEditServerBtn" type="submit" value="default" class="btn">Save Changes</button>
</menu>
<button type="button" value="cancel" class="modal-close-btn" title="Close" tabindex="-1">
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
    <line x1="18" y1="6" x2="6" y2="18"></line>
    <line x1="6" y1="6" x2="18" y2="18"></line>
  </svg>
</button>
</form>
</dialog>

<dialog id="deleteServerModal" class="modal">
<form method="dialog" class="card" style="max-width:500px;">
<div style="display:flex; align-items:center; gap:16px; margin-bottom:20px;">
<div style="width:48px; height:48px; border-radius:12px; background:rgba(239,68,68,0.1); display:flex; align-items:center; justify-content:center; flex-shrink:0;">
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
<path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
<line x1="12" y1="9" x2="12" y2="13"></line>
<line x1="12" y1="17" x2="12.01" y2="17"></line>
</svg>
</div>
<div style="flex:1;">
<h2 style="margin:0 0 8px 0;">Delete Server?</h2>
<p style="margin:0; color:var(--muted); font-size:14px;">Are you sure you want to delete this server? This action cannot be undone.</p>
</div>
</div>
<menu class="row end">
<button value="cancel" class="btn btn-ghost">Cancel</button>
<button id="confirmDeleteServerBtn" type="submit" value="default" class="btn btn-danger">Delete Server</button>
</menu>
</form>
</dialog>

<dialog id="selectCredentialModal" class="modal">
<form method="dialog" class="card" style="max-width:500px;">
<h2>Select Credential</h2>
<p class="muted" style="margin-bottom:16px;">Choose a credential to connect to <strong id="selectedServerName"></strong></p>

<label class="label">Connection Type
<select id="connectionTypeSelect" class="input" required>
<option value="rdp">RDP (Remote Desktop)</option>
<option value="ssh">SSH (Secure Shell)</option>
</select>
<span style="font-size:12px; color:var(--muted); margin-top:4px; display:block;">Select the connection protocol</span>
</label>

<label class="label">Authentication Method
<select id="connectionCredentialSelect" class="input" required>
<option value="windows-auth">Windows Authentication (Current User)</option>
<option value="">-- Select Saved Credential --</option>
</select>
<span style="font-size:12px; color:var(--muted); margin-top:4px; display:block;">Use Windows Authentication or select saved credentials</span>
</label>

<menu class="row end">
<button value="cancel" class="btn btn-ghost">Cancel</button>
<button id="confirmConnectionBtn" type="submit" value="default" class="btn">Connect</button>
</menu>

<button type="button" value="cancel" class="modal-close-btn" title="Close" tabindex="-1">
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
    <line x1="18" y1="6" x2="6" y2="18"></line>
    <line x1="6" y1="6" x2="18" y2="18"></line>
  </svg>
</button>
</form>
</dialog>

<!-- Database Setup Modals removed - no longer in use -->

<!-- System Configuration Modal -->
<dialog id="systemConfigModal" class="modal">
<form method="dialog" class="card" style="max-width:900px; width:90vw;">
<button type="submit" value="cancel" class="modal-close-btn" title="Close">
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
    <line x1="18" y1="6" x2="6" y2="18"></line>
    <line x1="6" y1="6" x2="18" y2="18"></line>
  </svg>
</button>

<div style="display:flex; align-items:center; gap:16px; margin-bottom:24px;">
  <div style="width:64px; height:64px; border-radius:20px; background:linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); display:flex; align-items:center; justify-content:center; flex-shrink:0;">
    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
      <path d="M3 5v14c0 3 4.5 4 9 4s9-1 9-4V5"></path>
    </svg>
  </div>
  <div style="flex:1;">
    <h2 style="margin:0 0 8px 0;">Database Configuration</h2>
    <p style="margin:0; color:var(--muted); font-size:14px;">Connect to your SQL Server database</p>
  </div>
</div>

<!-- Configuration Status Card -->
<div style="margin-bottom:24px;">
  <!-- Database Status -->
  <div class="config-card" id="databaseConfigCard" style="border:2px solid rgba(239,68,68,0.3); background:rgba(239,68,68,0.05); border-radius:12px; padding:20px;">
    <div style="display:flex; align-items:center; gap:12px; margin-bottom:16px;">
      <div class="config-status-icon config-status-icon--error">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
          <path d="M3 5v14c0 3 4.5 4 9 4s9-1 9-4V5"></path>
          <line x1="15" y1="9" x2="9" y2="15"></line>
          <line x1="9" y1="9" x2="15" y2="15"></line>
        </svg>
      </div>
      <div style="flex:1;">
        <h3 style="margin:0 0 4px 0; font-size:16px;">SQL Server Database</h3>
        <p style="margin:0; font-size:12px; color:var(--muted);" id="databaseStatusText">Not Connected</p>
      </div>
    </div>
  </div>
</div>

<!-- Setup Instructions -->
<div style="max-height:500px; overflow-y:auto; padding-right:8px;">
  
  <!-- Database Setup -->
  <div id="databaseSetupSection">
    <div style="display:flex; align-items:center; gap:12px; margin-bottom:16px; padding-bottom:12px; border-bottom:2px solid var(--border);">
      <div style="width:40px; height:40px; border-radius:12px; background:linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); display:flex; align-items:center; justify-content:center; color:white; font-weight:700; font-size:18px;">üìä</div>
      <h3 style="margin:0; font-size:18px;">SQL Server Database Connection</h3>
    </div>

    <div style="background:var(--bg); border:1px solid var(--border); border-radius:8px; padding:20px; margin-bottom:16px;">
      <h4 style="margin:0 0 16px 0; font-size:14px; color:#3b82f6;">ÔøΩ Connect to SQL Server</h4>
      <p style="margin:0 0 16px 0; font-size:13px; color:var(--muted);">Enter your SQL Server connection details below:</p>
      
      <div style="display:grid; gap:16px;">
        <label class="label" style="margin:0;">
          Server
          <input type="text" id="dbConfigServer" class="input" placeholder="localhost or 192.168.1.100" value="localhost" />
        </label>
        
        <label class="label" style="margin:0;">
          Database Name
          <input type="text" id="dbConfigDatabase" class="input" placeholder="OrbisHub" value="OrbisHub" />
        </label>
        
        <label class="label" style="margin:0;">
          Authentication
          <select id="dbConfigAuthType" class="input" style="padding:10px;">
            <option value="windows">Windows Authentication</option>
            <option value="sql">SQL Server Authentication</option>
          </select>
        </label>
        
        <div id="sqlAuthFields" style="display:none; grid-column:1/-1;">
          <div style="display:grid; gap:16px;">
            <label class="label" style="margin:0;">
              Username
              <input type="text" id="dbConfigUser" class="input" placeholder="sa" />
            </label>
            
            <label class="label" style="margin:0;">
              Password
              <input type="password" id="dbConfigPassword" class="input" placeholder="Your SQL password" />
            </label>
          </div>
        </div>
        
        <label style="display:flex; align-items:center; gap:8px; margin:0; cursor:pointer;">
          <input type="checkbox" id="dbConfigEncrypt" checked style="width:16px; height:16px; cursor:pointer;" />
          <span style="font-size:13px; color:var(--text);">Encrypt connection</span>
        </label>
        
        <label style="display:flex; align-items:center; gap:8px; margin:0; cursor:pointer;">
          <input type="checkbox" id="dbConfigTrustCert" checked style="width:16px; height:16px; cursor:pointer;" />
          <span style="font-size:13px; color:var(--text);">Trust server certificate</span>
        </label>
      </div>
      
      <div style="display:flex; gap:12px; margin-top:20px;">
        <button type="button" class="btn btn-primary" id="testDbConnectionBtn" style="flex:1;">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:6px;">
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
          Test Connection
        </button>
        <button type="button" class="btn btn-success" id="saveDbConfigBtn" style="flex:1; background:linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:6px;">
            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
            <polyline points="17 21 17 13 7 13 7 21"></polyline>
            <polyline points="7 3 7 8 15 8"></polyline>
          </svg>
          Save Config
        </button>
        <button type="button" class="btn btn-primary" id="createDatabaseBtn" style="flex:1; background:linear-gradient(135deg, #10b981 0%, #059669 100%);">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:6px;">
            <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
            <path d="M3 5v14c0 3 4.5 4 9 4s9-1 9-4V5"></path>
          </svg>
          Create Database
        </button>
      </div>
      
      <div id="dbConnectionResult" style="margin-top:16px; padding:12px; border-radius:6px; display:none; font-size:13px;">
        <!-- Result message will be shown here -->
      </div>
    </div>

    <div style="background:linear-gradient(135deg, rgba(59,130,246,0.1) 0%, rgba(29,78,216,0.05) 100%); border:1px solid rgba(59,130,246,0.3); border-radius:8px; padding:16px;">
      <h4 style="margin:0 0 12px 0; font-size:14px; color:#3b82f6;">üí° Need SQL Server?</h4>
      <p style="margin:0 0 8px 0; font-size:13px; color:var(--muted);">If you don't have SQL Server installed:</p>
      <ul style="margin:0; padding-left:20px; font-size:13px; color:var(--muted);">
        <li style="margin-bottom:6px;"><strong>SQL Server Express</strong> - Free, lightweight version</li>
        <li style="margin-bottom:0;"><strong>SQL Server Developer</strong> - Full features, free for dev/test</li>
      </ul>
    </div>
  </div>

</div>

<!-- Quick Actions -->
<div style="border-top:2px solid var(--border); padding-top:20px; margin-top:24px; display:flex; gap:12px; justify-content:flex-end;">
  <button type="button" class="btn btn-ghost" onclick="window.open('https://www.microsoft.com/sql-server/sql-server-downloads', '_blank')">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:6px;">
      <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
      <polyline points="15 3 21 3 21 9"></polyline>
      <line x1="10" y1="14" x2="21" y2="3"></line>
    </svg>
    Download SQL Server
  </button>
  <button type="submit" value="close" class="btn btn-primary">Done</button>
</div>

</form>
</dialog>

<!-- OrbisAgent Modals -->
<!-- Agent Details Modal -->
<dialog id="agentDetailsModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Agent Details</h2>
            <button class="modal-close" onclick="document.getElementById('agentDetailsModal').close()">&times;</button>
        </div>
        <div class="modal-body">
            <!-- Agent Info -->
            <div class="agent-details-grid">
                <div class="agent-detail-item">
                    <div class="agent-detail-item__label">Machine Name</div>
                    <div class="agent-detail-item__value" id="agentDetailName">‚Äî</div>
                </div>
                <div class="agent-detail-item">
                    <div class="agent-detail-item__label">Operating System</div>
                    <div class="agent-detail-item__value" id="agentDetailOS">‚Äî</div>
                </div>
                <div class="agent-detail-item">
                    <div class="agent-detail-item__label">IP Address</div>
                    <div class="agent-detail-item__value agent-detail-item__value--mono" id="agentDetailIP">‚Äî</div>
                </div>
                <div class="agent-detail-item">
                    <div class="agent-detail-item__label">Status</div>
                    <div class="agent-detail-item__value" id="agentDetailStatus">‚Äî</div>
                </div>
                <div class="agent-detail-item">
                    <div class="agent-detail-item__label">Version</div>
                    <div class="agent-detail-item__value" id="agentDetailVersion">‚Äî</div>
                </div>
                <div class="agent-detail-item">
                    <div class="agent-detail-item__label">Last Seen</div>
                    <div class="agent-detail-item__value" id="agentDetailLastSeen">‚Äî</div>
                </div>
            </div>
            
            <!-- Tab Navigation -->
            <div class="agent-tabs">
                <button class="agent-tab agent-tab--active" onclick="AgentUI.switchTab('jobs')">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    Recent Jobs
                </button>
                <button class="agent-tab" onclick="AgentUI.switchTab('builds')">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                        <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
                    </svg>
                    Build History
                </button>
            </div>
            
            <!-- Tab Content -->
            <div class="agent-tab-content">
                <!-- Recent Jobs Tab -->
                <div id="agentTabJobs" class="agent-tab-panel agent-tab-panel--active">
                    <div id="agentDetailJobs" class="agent-jobs-list">
                        <p class="muted" style="text-align:center; padding:20px;">Loading...</p>
                    </div>
                </div>
                
                <!-- Build History Tab -->
                <div id="agentTabBuilds" class="agent-tab-panel">
                    <div id="agentDetailBuilds" class="agent-builds-list">
                        <p class="muted" style="text-align:center; padding:20px;">Loading...</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-ghost" onclick="document.getElementById('agentDetailsModal').close()">Close</button>
        </div>
    </div>
</dialog>

<!-- Run Job Modal -->
<dialog id="runJobModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Run Job on Agent</h2>
            <button class="modal-close" onclick="document.getElementById('runJobModal').close()">&times;</button>
        </div>
        <div class="modal-body">
            <p style="margin-bottom:20px; color:var(--muted);">
                Execute a script or command on agent: <strong id="runJobAgentName" style="color:var(--text);">‚Äî</strong>
            </p>
            
            <div>
                <label for="commandTemplate">Command Template</label>
                <select id="commandTemplate" onchange="AgentUI.loadCommandTemplate()">
                    <option value="">-- Select a template or write your own --</option>
                    <optgroup label="System Control">
                        <option value="restart">Restart Computer</option>
                        <option value="shutdown">Shutdown Computer</option>
                        <option value="logoff">Log Off Current User</option>
                    </optgroup>
                    <optgroup label="System Information">
                        <option value="systeminfo">Get System Information</option>
                        <option value="diskspace">Check Disk Space</option>
                        <option value="network">Network Configuration</option>
                        <option value="processes">Running Processes (Top CPU)</option>
                        <option value="services">Windows Services Status</option>
                        <option value="updates">Check Windows Updates</option>
                    </optgroup>
                    <optgroup label="Maintenance">
                        <option value="cleartmp">Clear Temp Files</option>
                        <option value="eventlogs">Get Recent Event Logs</option>
                        <option value="installedapps">List Installed Applications</option>
                        <option value="gpupdate">Force Group Policy Update</option>
                    </optgroup>
                    <optgroup label="Diagnostics">
                        <option value="ping">Ping Test (Google DNS)</option>
                        <option value="tracert">Trace Route (Google DNS)</option>
                        <option value="memory">Memory Usage Details</option>
                        <option value="cpu">CPU Usage Details</option>
                    </optgroup>
                </select>
            </div>
            
            <div>
                <label for="jobType">Job Type</label>
                <select id="jobType">
                    <option value="PowerShell">PowerShell Script</option>
                </select>
            </div>
            
            <div>
                <label for="jobScript">Script / Command</label>
                <textarea id="jobScript" rows="10" placeholder="Enter PowerShell script or command here...&#10;&#10;Or select a template above to get started!"></textarea>
            </div>
            
            <div class="modal-info-box">
                <strong>üí° Tip:</strong> Scripts execute in PowerShell context on the remote machine. Ensure proper syntax and permissions.
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-ghost" onclick="document.getElementById('runJobModal').close()">Cancel</button>
            <button class="btn" onclick="AgentUI.submitJob()" style="background:linear-gradient(135deg, #10b981 0%, #059669 100%); color:white; border:none;">
                <span>‚ñ∂</span> Submit Job
            </button>
        </div>
    </div>
</dialog>

<!-- Agent Deployment Guide Modal -->
<dialog id="agentDeploymentModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Deploy OrbisAgent</h2>
            <button class="modal-close" onclick="document.getElementById('agentDeploymentModal').close()">&times;</button>
        </div>
        <div class="modal-body">
            <div>
                <h3>Quick Install (Recommended)</h3>
                <p style="color:var(--muted); margin-bottom:20px;">One command to download and install the agent on a remote Windows PC:</p>
                
                <div class="deployment-steps">
                    <div class="deployment-step">
                        <div class="deployment-step__number deployment-step__number--1">1</div>
                        <div class="deployment-step__content">
                            <h4 class="deployment-step__title">Open PowerShell as Administrator</h4>
                            <p class="deployment-step__description">On the target PC, right-click PowerShell and select "Run as Administrator"</p>
                        </div>
                    </div>
                    
                    <div class="deployment-step">
                        <div class="deployment-step__number deployment-step__number--2">2</div>
                        <div class="deployment-step__content">
                            <h4 class="deployment-step__title">Run Installation Command</h4>
                            <p class="deployment-step__description">Copy and paste this command on the remote PC:</p>
                            <div class="deployment-code-block">
                                <pre class="deployment-code" id="bootstrapCommand">Loading...</pre>
                                <button class="deployment-code-copy" id="copyBootstrapBtn">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="16 1 21 6 8 19 3 19 3 14 16 1"></polyline>
                                    </svg>
                                    Copy
                                </button>
                            </div>
                            <p style="color:var(--muted); font-size:12px; margin-top:8px;">
                                This command will automatically detect your server IP and download the agent.
                            </p>
                        </div>
                    </div>
                    
                    <div class="deployment-step">
                        <div class="deployment-step__number deployment-step__number--3">3</div>
                        <div class="deployment-step__content">
                            <h4 class="deployment-step__title">Verify Installation</h4>
                            <p class="deployment-step__description">The agent will install and start automatically. It will appear in this dashboard within 30 seconds.</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="margin-top:30px; padding-top:30px; border-top:1px solid var(--border);">
                <h3>Manual Installation</h3>
                <p style="color:var(--muted); margin-bottom:15px;">If you prefer manual installation or the quick install fails:</p>
                
                <div style="margin-bottom:15px;">
                    <h4 style="font-size:14px; margin-bottom:8px;">Step 1: Download Installer</h4>
                    <div class="deployment-code-block">
                        <pre class="deployment-code" id="downloadInstallerCommand">Loading...</pre>
                        <button class="deployment-code-copy" id="copyDownloadInstallerBtn">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="16 1 21 6 8 19 3 19 3 14 16 1"></polyline>
                            </svg>
                            Copy
                        </button>
                    </div>
                </div>
                
                <div>
                    <h4 style="font-size:14px; margin-bottom:8px;">Step 2: Run Installer</h4>
                    <div class="deployment-code-block">
                        <pre class="deployment-code" id="runInstallerCommand">Loading...</pre>
                        <button class="deployment-code-copy" id="copyRunInstallerBtn">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="16 1 21 6 8 19 3 19 3 14 16 1"></polyline>
                            </svg>
                            Copy
                        </button>
                    </div>
                </div>
            </div>
            
            <div style="margin-top:30px; padding-top:30px; border-top:1px solid var(--border);">
                <h3>What Gets Installed?</h3>
                <ul style="color:var(--muted); font-size:14px; line-height:1.8;">
                    <li>OrbisAgent installed to <code>C:\Program Files\OrbisAgent</code></li>
                    <li>Windows Scheduled Task running as SYSTEM with admin privileges</li>
                    <li>Auto-starts on boot with automatic restart on failure</li>
                    <li>Sends heartbeats every 30 seconds with system metrics</li>
                    <li>Polls for jobs every 5 seconds</li>
                </ul>
            </div>
            
            <div style="margin-top:30px; padding-top:30px; border-top:1px solid var(--border);">
                <h3>Uninstall Agent</h3>
                <p style="color:var(--muted); margin-bottom:15px;">To remove the agent from a PC:</p>
                <div class="deployment-code-block">
                    <pre class="deployment-code" id="uninstallCommand">Loading...</pre>
                    <button class="deployment-code-copy" id="copyUninstallBtn">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="16 1 21 6 8 19 3 19 3 14 16 1"></polyline>
                        </svg>
                        Copy
                    </button>
                </div>
            </div>
            
            <div class="security-warning">
                <div class="security-warning__header">
                    <span class="security-warning__icon">!</span>
                    <strong class="security-warning__title">Security Note</strong>
                </div>
                <p class="security-warning__text">This initial implementation is designed for trusted internal networks. For production use, implement API key authentication, HTTPS encryption, and script validation.</p>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn" onclick="document.getElementById('agentDeploymentModal').close()" style="background:linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color:white; border:none;">
                <span>‚úì</span> Got It
            </button>
        </div>
    </div>
</dialog>

<!-- Delete Agent Confirmation Modal -->
<dialog id="deleteAgentModal" class="modal">
    <form method="dialog" class="card card--compact">
        <h2>Uninstall Agent</h2>
        <p class="muted">Uninstall OrbisAgent from "<span id="deleteAgentName"></span>"?</p>
        <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 8px; padding: 12px; margin: 16px 0; font-size: 13px;">
            <strong style="color: #f87171; display: block; margin-bottom: 8px;">‚ö†Ô∏è This action will:</strong>
            <ul style="margin: 0; padding-left: 20px; color: var(--muted);">
                <li>Stop and remove OrbisAgent scheduled task/service</li>
                <li>Delete agent files (except agent-id.txt)</li>
                <li id="deleteRestartOption"><strong>Restart the target machine immediately</strong></li>
            </ul>
        </div>
        
        <!-- Restart Option -->
        <label class="label" style="margin: 16px 0; display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="checkbox" id="deleteAgentRestart" checked style="width: 18px; height: 18px; cursor: pointer;">
            <span style="font-size: 14px; user-select: none;">Restart machine after uninstall</span>
        </label>
        
        <menu class="row end" id="deleteAgentButtons">
            <button value="cancel" class="btn btn-ghost">Cancel</button>
            <button value="confirm" id="confirmDeleteAgentBtn" class="btn btn-danger">Uninstall Agent</button>
        </menu>
    </form>
</dialog>

<!-- Socket.IO removed for desktop app -->
<script src="services/db.js"></script>
<script src="services/messages.js"></script>
<script src="services/data.js"></script>
<script src="services/audit.js"></script>
<script src="services/entities.js"></script>
<script src="app.js"></script>
<!-- Utilities -->
<script src="utils/toast.js"></script>
<script src="views/environments.js"></script>
<!-- OrbisAgent Module -->
<script src="../Functions/OrbisAgent/agent-api.js"></script>
<script src="../Functions/OrbisAgent/agent-ui.js"></script>
<!-- Ticket Management Module -->
<script src="../Functions/TicketManagement/ticket-service.js"></script>
<script src="../Functions/TicketManagement/ticket-ui.js"></script>
<!-- Password Manager Module -->
<script src="../Functions/PasswordManager/password-service.js"></script>
<script src="../Functions/PasswordManager/password-ui.js"></script>
<!-- Bug Reporting Module -->
<script src="../Functions/BugReporting/bug-service.js"></script>
<script src="../Functions/BugReporting/bug-ui.js"></script>
<!-- Email Server Profile Module -->
<script src="../Functions/EmailServerProfile/email-service.js"></script>
<script src="../Functions/EmailServerProfile/email-ui.js"></script>
<!-- User Recovery Module -->
<script src="../Functions/UserRecovery/recovery-service.js"></script>
<script src="../Functions/UserRecovery/recovery-ui.js"></script>
<!-- DB Maintenance Module -->
<script src="../Functions/DBMaintenance/db-maintenance-service.js"></script>
<script src="../Functions/DBMaintenance/db-maintenance-ui.js"></script>
<!-- Permissions Module -->
<script src="../Functions/UserPermissions/permissions-service.js"></script>
<script src="../Functions/UserPermissions/permissions-ui.js"></script>
<script src="../Functions/UserPermissions/permissions-manager-ui.js"></script>
<!-- Core -->
<script src="app-main.js"></script>
</body>
</html>

